<div class="row">
    <div class="col-sm-12">
        <div class="page-title-box p-b-30">
            <div class="col-6" style="padding-left:0px;" >
            <h4 class="page-title">View Audit Planning</h4></div>
            <div class="text-right float-right col-6">
                <a class="btn btn-secondary btn-sm active" href="#" role="button" [routerLink]="['/audit/list-audit-plan']" >Back</a>
            </div>
        </div>	
    </div>
</div>
<div class="row" style="padding-top:20px;" *ngIf="loading"  ><span class="spinner-border spinner-border-sm mr-1"></span></div>
<div class="row" style="padding-top:20px;" *ngIf="auditPlanData"  >
    <div class="col-sm-12 mat-accordion">
        <div class="mat-accordion">
            <div class="card-box enq-view">
                <h3>Company Details</h3>
                <table class="table-secondary m-b-15">
                    <tr>
                        <th width="20%">Company Name</th>
                        <td width="30%">{{ auditPlanData.company_name }}</td>
                        <th width="20%">Zipcode</th>
                        <td width="30%">{{ auditPlanData.zipcode }}</td>
                    </tr>
                    <tr>
                        <th width="20%">Address</th>
                        <td width="30%">{{ auditPlanData.address }}</td>
                        <th width="20%">Country</th>
                        <td width="30%">{{ auditPlanData.country_name }}</td>
                    </tr>
                    <tr>
                        <th width="20%">State</th>
                        <td width="30%">{{ auditPlanData.state_name }}</td>
                        <th width="20%">City</th>
                        <td width="30%">{{ auditPlanData.city }}</td>
                    </tr>

                </table>
            </div>
        </div>
        
        <div class="mat-accordion" *ngIf="(userType!=2 && auditPlanData.reviewer_details!='' && auditPlanData.reviewer_details!== undefined) && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution')) || (userType==1 && !userdetails.rules.includes('brand_management') ))">
            <div class="card-box enq-view">
                <h3>Reviewer Details</h3>
                <table class="table-secondary m-b-15">
                    <tr>
                        <th width="20%">Reviewer</th>
                        <td width="30%">{{ auditPlanData.reviewer_details.reviewer_name}}</td>
                        <th width="20%">Assigned Date</th>
                        <td width="30%">{{ auditPlanData.reviewer_details.created_at}}</td>
                    </tr>
                    <tr *ngIf="auditPlanData.reviewer_details.technicalexpertnames.length > 0" >
                        <th width="20%" >Technical Expert(s)</th>
                        <td colspan="3">{{ auditPlanData.reviewer_details.technicalexpertnames.join(', ') }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="col-12 row mat-accordion m-t-10" *ngIf="auditPlanData.show_followup_status && auditPlanData.followup_status && auditPlanData.status!=auditPlanData.arrEnumStatus['followup_open']" >
            <div class="card-box enq-view">                			
                <button type="button" (click)="changeAuditTab('normal')" class="btn btn-sm {{normaldivcontentstatus ? 'btn-success' : 'btn-primary'}}">Initial</button>
                <button type="button" (click)="changeAuditTab('followup')" class="btn btn-sm {{followupdivcontentstatus ? 'btn-success' : 'btn-primary'}}" style="margin-left:3px;">Follow-Up</button>                
            </div>
        </div>
		
        <div class=" {{ auditPlanData.followup_status && auditPlanData.status!=auditPlanData.arrEnumStatus['followup_open'] ? 'add card-box table-responsive' : '' }} " *ngIf="normaldivcontentstatus">		
            <div class="mat-accordion" *ngIf="userType!=2">
                <div class="card-box enq-view">
                    <h3>Audit Details</h3>
                    <table class="table-secondary">
                        <tr>
                            <th width="20%">Lead Auditor</th>
                            
                            <ng-container *ngIf="auditPlanData.audit_type!=2; else unannouncedauditTemp" >
                                <td width="30%">{{ auditPlanData.application_lead_auditor_name }}</td>

                                <th width="20%">Quotation Manday(s)</th>
                                <td width="30%">{{ auditPlanData.quotation_manday }}</td>
                            </ng-container>
                            <ng-template #unannouncedauditTemp>
                                <td colspan="3">{{ auditPlanData.application_lead_auditor_name }}</td>
                            </ng-template>
                        </tr>
                        <tr>
                            <th width="20%">Actual Manday(s)</th>
                            <td width="30%">{{ auditPlanData.actual_manday }}</td>
                            <th width="20%">Created By</th>
                            <td width="30%">{{ auditPlanData.created_by_name }}</td>
                        </tr>

                        <tr *ngIf="auditPlanData.audit_type==2">
                            <th width="20%">Share Audit Plan to Customer</th>
                            <td width="30%">{{ auditPlanData.share_plan_to_customer_label }}</td>
                            <th width="20%">Reason </th>
                            <td width="30%">{{ auditPlanData.unannounced_audit_reason }}</td>
                        </tr>

                        <tr>
                            <th width="20%">Created At</th>
                            <td width="30%">{{ auditPlanData.created_at }}</td>
                            <th width="20%">Status</th>
                            <td width="30%">{{ auditPlanData.plan_status_name }}</td>
                        </tr>
                        <tr>
                            <th width="20%">Application Type</th>
                            <td width="30%">{{ auditPlanData.type_label }}</td>
                            <th width="20%">Audit Type</th>
                            <td width="30%">{{ auditPlanData.audit_type_name }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="mat-accordion m-t-10" *ngIf="auditPlanData.status == auditPlanData.arrEnumStatus['rejected']"  >
                <div class="card-box enq-view">
                    <h3>Audit Plan Rejected Details</h3>
                    <table class="table-secondary m-b-15">
                        <tr>
                            <th width="20%">Rejected By</th>
                            <td width="30%">{{ auditPlanData.customer_review_created_by_name }}</td>
                            
                            <th width="20%">Rejected On</th>
                            <td width="30%">{{ auditPlanData.customer_review_created_at }}</td>
                        </tr>
                        <tr>
                            <th width="20%">Comment</th>
                            <td width="80%" colspan="3">{{ auditPlanData.customer_review_comment }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="mat-accordion" >
                <div class="card-box enq-view" *ngFor="let unit of auditPlanData?.units; index as i">
                    <div *ngIf="(userdetails.resource_access==1 || (!userdetails.rules.includes('brand_management')) || (userType==1 && userdetails.rules.includes('brand_management') && unit.unit_brand_consent==1))">
                    <!-- 
                    <h3>{{ unit.unit_name }} [<ng-container *ngFor="let std of unit.standard; let stdi=index;">{{std.standard_name}} <span *ngIf="stdi+1!=unit.standard.length">,</span></ng-container>]</h3>
                    -->
                    <div class="un-lst"><h3>{{ unit.unit_name }}  [<ng-container *ngFor="let std of unit.standard; let stdi=index;">{{std.standard_name}}<span *ngIf="stdi+1!=unit.standard.length">, </span></ng-container>]</h3></div> 
                                    
                    <!-- New Button Code Start Here ------- -->
                    
                    
                    <!--
                    <div *ngIf="unit.followup_status" >				
                        <button type="button" (click)="changeAuditTab('normal',unit.id)" class="btn btn-sm {{normalcontentstatus[unit.id] ? 'btn-success' : 'btn-primary'}}">Normal</button>
                        <button type="button" (click)="changeAuditTab('followup',unit.id)" class="btn btn-sm {{followupcontentstatus[unit.id] ? 'btn-success' : 'btn-primary'}}" style="margin-left:3px;">Follow-Up</button>
                    </div>
                    -->
                    <!--{{unit.followup_status?'card-box':'' }}-->
                    <div class="add pad-left pad-right table-responsive enq-view col-12" >
                        
                    
                        
                        <table class="table-secondary m-b-15" *ngIf="userType==2 || userType==3 || (userType==1 && !userdetails.rules.includes('brand_management'))" >
                            <tr>
                                    <th width="20%">Unit Date(s)</th>
                                    <td  colspan="3"><div *ngFor="let date of unit.date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div></td>								
                                </tr>
                                <tr>
                                    <ng-container *ngIf="auditPlanData.audit_type!=2; else unannouncedauditTemp2" >
                                        <th width="20%">Quotation Manday(s)</th>
                                        <td width="30%">{{ unit.quotation_manday }}</td>
                                        <th width="20%">Lead Auditor</th>
                                        <td width="30%">{{unit.unit_lead_auditor}}</td>
                                    </ng-container>
                                   
                                    <ng-template #unannouncedauditTemp2>
                                        <th width="20%">Lead Auditor</th>
                                        <td  colspan="3" >{{unit.unit_lead_auditor}}</td>
                                    </ng-template>
                                </tr>
                                <tr>
                                    <th width="20%">Actual Manday(s)</th>
                                    <td width="30%">{{unit.actual_manday}}</td>
                                    <th width="20%">Technical Expert</th>
                                    <td width="30%">{{ unit.technical_expert==''?'NA':unit.technical_expert }}</td>								
                                </tr>
                                <tr>
                                    <th width="20%">Translator Required</th>
                                    <td width="30%">{{ auditPlanData?.manday[i]?.translator_required === "true" ? "Yes": "No" }}</td>
                                    <th width="20%">Adjusted Manday</th>
                                    <td width="30%">{{auditPlanData?.manday[i]?.adjusted_manday}}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Final Manday(s)</th>
                                    <td width="30%">{{ auditPlanData?.manday[i]?.final_manday_withtrans }}</td>
                                    <th width="20%">Adjusted Manday Comments</th>
                                    <td width="30%">{{ auditPlanData?.manday[i]?.adjusted_manday_comment }}</td>
                                </tr>
                               
                                <tr>
                                    <th width="20%">Translator</th>
                                    <td width="30%">{{ unit.translator==''?'NA':unit.translator }}</td>
                                    <th width="20%">Observer</th>
                                    <td width="30%">{{unit.observer}}</td>								
                                </tr>
                                <tr>
                                    <th width="20%">Status</th>
                                    <td width="30%">{{unit.status_label}}</td>
                                    <th width="20%">Status Changed Date</th>
                                    <td colspan="3">{{unit.status_change_date}}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Trainee Auditor</th>
                                    <td width="30%">{{unit.trainee_auditor}}</td>
                                </tr>

                                <tr *ngIf="auditPlanData.status >= auditPlanData.arrEnumStatus['approved']">
                                    <th width="20%">Total Findings</th>
                                    <td width="30%">{{unit.total_findings}}</td>
                                    <th width="20%">Total Non Conformities</th>
                                    <td width="30%">{{unit.total_non_conformity}}</td>
                                </tr>
                            </table>
                        
                            <table class="table table-bordered col-12" style="font-size:13px;"  *ngIf="userType!=2">
                                <thead>
                                <tr>
                                    <th width="5%" scope="col" class="center">S.No</th>
                                    <th width="20%"scope="col">Auditor</th>
                                    <th scope="col">Date(s)</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let auditor of unit?.auditors; index as is;" >
                                        <td scope="row" class="center"   >{{ 1+is}}</td>
                                        <td >{{ auditor.display_name }} <span *ngIf="auditor.is_justified_user">*</span></td>
                                        <td>
                                            <!-- 
                                            <span *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d">{{ date}} </span>
                                            <ng-container *ngIf="last"> &amp; </ng-container> {{ date}}<span *ngIf="!last">, </span> -->
                                            <div *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div>
                                        </td>
                                    </tr> 
                                </tbody>
                            </table>
                            
                            <table class="table table-bordered col-12" style="font-size:13px;"  *ngIf="(userType!=2  && auditPlanData.status >= auditPlanData.arrEnumStatus['approved'] && auditPlanData.status != auditPlanData.arrEnumStatus['rejected']) && (userType==2 || userType==3 || (userType==1 && !userdetails.rules.includes('brand_management')))">
                                <thead>
                                <tr>
                                    <th scope="col" class="center" width="6%">S.No</th>
                                    <th scope="col">Sub Topic</th>
                                    <th scope="col" class="center">Status</th>
                                    <th scope="col">Reviewed By</th>
                                    <th scope="col" class="center" >Reviewed Date</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let subtopic of unit?.subtopics; index as st;" >
                                        <td scope="row" class="center"   >{{ 1+st}}</td>
                                        <td >{{ subtopic.name }}</td>
                                        <td class="center" >{{ subtopic.status_name }}</td>
                                        <td >{{ subtopic.display_name }}</td>
                                        <td class="center" >{{ subtopic.executed_date }}</td>
                                    </tr> 
                                </tbody>
                            </table>	
                            <!-- [routerLink]="['/audit/audit-execution']" [queryParams]="{audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.id}"-->
                            <button type="button" *ngIf="unit.is_subtopic_assigned && (unit.status==auditPlanData.arrUnitEnumStatus['reviewer_reinititated'] || unit.status==auditPlanData.arrUnitEnumStatus['open'] || unit.status==auditPlanData.arrUnitEnumStatus['in_progress'] || unit.status==auditPlanData.arrUnitEnumStatus['awaiting_for_unit_lead_auditor_approval']) && auditPlanData.status >= auditPlanData.arrEnumStatus['approved'] && auditPlanData.status != auditPlanData.arrEnumStatus['rejected'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution') && unit.auditorIds.includes(userdetails.uid) ) ) " (click)="open(executeAuditContent,'executeAudit',{audit_plan_unit_id:unit.id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id},i)"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                            Conduct the Audit</button>
                            
                            <!-- Button For Audit Lead Auditor -->
                            
                            <button type="button"
                             *ngIf="(unit.status==auditPlanData.arrUnitEnumStatus['awaiting_for_lead_auditor_approval']) 
                             && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) ) "
                              (click)="open(executeAuditContent,'executeAudit',{audit_plan_unit_id:unit.id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id},i)"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                           Conduct the Audit</button>

                            <button type="button" *ngIf="unit.show_assign_subtopic && auditPlanData.status >= auditPlanData.arrEnumStatus['approved'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution') && unit.auditorIds.includes(userdetails.uid) ) ) " (click)="openmodal(assignSubtopic,'assignSubtopic',{audit_plan_unit_id:unit.id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                            Assign SubTopic</button>


                            <button type="button"
                             *ngIf="((userType==2 && (unit.status==auditPlanData.arrUnitEnumStatus['audit_completed'] || unit.status==auditPlanData.arrUnitEnumStatus['remediation_in_progress'])) || (userType==1 && unit.status>=auditPlanData.arrUnitEnumStatus['in_progress'] )) && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution')) || (userType==1 && !userdetails.rules.includes('brand_management') )) " 
                             [routerLink]="['/audit/audit-findings']" [queryParams]="{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id,audit_plan_unit_id:unit.id,type:'all'}" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                View Checklist
                            </button>
                            
                            <button type="button" *ngIf="unit.total_non_conformity>0 && ((userType==2 && (unit.status==auditPlanData.arrUnitEnumStatus['audit_completed'] || unit.status==auditPlanData.arrUnitEnumStatus['remediation_in_progress'])) || (userType==1 && unit.status>=auditPlanData.arrUnitEnumStatus['in_progress'] && unit.status<=auditPlanData.arrUnitEnumStatus['remediation_in_progress']))" [routerLink]="['/audit/audit-findings']" [queryParams]="{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id,audit_plan_unit_id:unit.id,type:'nc'}" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                View Non Conformities
                            </button>
                            <!-- *ngIf="unit.status==auditPlanData.arrUnitEnumStatus['awaiting_for_unit_lead_auditor_approval']  && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==unit.unit_lead_auditor_id && userdetails.rules.includes('audit_execution')))"-->
                           
                            <button   type="button" 
                            *ngIf="unit.status==auditPlanData.arrUnitEnumStatus['awaiting_for_unit_lead_auditor_approval']  
                            && ((userdetails.resource_access==1 || userdetails.resource_access==2)|| (userType==1 && userdetails.uid==unit.unit_lead_auditor_id && userdetails.rules.includes('audit_execution')))"
                             (click)="open(sendToLeadAuditorContent,'sendtoleadauditor',{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id,audit_plan_unit_id:unit.id})" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                Submit for Lead Auditor Approval</button>


                            <button type="button" *ngIf="(unit.status >= auditPlanData.arrUnitEnumStatus['audit_completed'] || unit.status == auditPlanData.arrUnitEnumStatus['remediation_in_progress']) && (userType==2 || userType==3 || userdetails.resource_access==1 || (userType==1 && (userdetails.rules.includes('audit_execution') || userdetails.rules.includes('assign_as_oss_review_for_tc') || userdetails.rules.includes('report_for_peer_reviewer') )) || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) || (userType==1 && userdetails.uid==auditPlanData.reviewer_id ) || (userType==1 && userdetails.uid==unit.unit_lead_auditor_id && userdetails.rules.includes('audit_execution'))) " [disabled]="loading" class="btn but-cust green m-b-5 ml-2 mr-2" (click)="downloadunitNCreport(this.id,auditPlanData.id,unit.id);openmodal(downloading)">
                                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                Download NC Report
                            </button>
							
							<ng-container *ngIf="auditPlanData.plan_status >= auditPlanData.arrEnumPlanStatus['audit_completed'] && (userType==2 || userdetails.resource_access==1 ||  (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) || (userType==1 && userdetails.rules.includes('audit_review') ) || (userType==1 && userdetails.rules.includes('brand_management') )) ">
								<button type="button"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  *ngFor="let unitstd of unit.standard; index as i" style="width:auto;" (click)="downloadAuditreport(this.id,auditPlanData.id,unitstd.standard_id,unit.id);openmodal(downloading)">
								<span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
								Download Audit Report for {{unitstd.standard_name}}</button>
							</ng-container>						

                            <div *ngIf="successUnitIndex==unit.id" >
                                <app-usermessage [success]="unitsuccess" [error]="uniterror"  ></app-usermessage>
                            </div>
                        

                            <div style="float:left;width:100%;" *ngIf="auditPlanData?.sel_brand_ch==1 && (userdetails.resource_access==1 || userType==2 )"  >
                                <mat-accordion>
                                    <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                Audit Brand Consent
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        <div class="card-box enq-view" >
                                        
                                            <h3>Brand Consent</h3>
                                          
                                            <app-app-audit-consent [unit_id]="unit.unit_id" [app_id]="auditPlanData.app_id" [unit_type]="unit.unit_type"></app-app-audit-consent>
                                            
                                                       
                                        </div>
                                    </mat-expansion-panel>                
                                </mat-accordion>
                            </div>
                  	
                    
                    </div>
                </div>
            </div>
            </div>

            <div style="float:left;width:100%;"  *ngIf="auditPlanData?.inspectionplan && (userType==2 || userType==3 || (userType==1 && !userdetails.rules.includes('brand_management')))">
                <mat-accordion>
                    <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                Audit Plan
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="card-box enq-view" >
                        
                            <h3>Audit Plan Details</h3>
                            
							<div class="mat-accordion">																
								<table class="table-secondary m-b-15">
									<tr>
										<th width="20%">Created By</th>
										<td width="30%">{{ auditPlanData.inspection_created_by }}</td>
										<th width="20%">Created Date</th>
										<td width="30%">{{ auditPlanData.inspection_created_at }}</td>
									</tr>
									<tr>
										<th width="20%">Sent By</th>
										<td width="30%">{{ auditPlanData.inspection_sent_by }}</td>
										<th width="20%">Sent Date</th>
										<td width="30%">{{ auditPlanData.inspection_sent_at }}</td>
									</tr>									
								</table>								
							</div>
                            
                            <table class="table table-bordered col-12" style="font-size:13px;">
                                <thead>
                                <tr>
                                    <th scope="col" class="center" width="5%">S.No</th>
                                    <th scope="col" width="15%">Location</th>
                                    <th scope="col" width="15%">Activity</th>
                                    <th scope="col" width="15%">Inspector</th>
                                    <th scope="col" width="12%" class="center">Date</th>
                                    <th scope="col" width="9%" class="center">Start Time</th>
                                    <th scope="col" width="9%" class="center">End Time</th>
                                    <th scope="col" width="20%">Persons need to be present</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr  *ngFor="let plans of auditPlanData?.inspectionplan; index as is">
                                        <td scope="row" class="center">{{ 1+is}}</td>
                                        <td>{{ plans.application_unit_name }}</td>
                                        <td>{{ plans.activity }}</td>
                                        <td>{{ plans.inspector }}</td>
                                        <td class="center">{{ plans.date }}</td>
                                        <td class="center">{{ plans.start_time }}</td>
                                        <td class="center">{{ plans.end_time }}</td>
                                        <td>{{ plans.person_need_to_be_present }}</td>
                                    </tr> 
                                </tbody>
                            </table>
                            
                        </div>
                        <button type="button"  *ngIf="(userType==2 && auditPlanData.status >= auditPlanData.arrEnumStatus['awaiting_for_customer_approval']  ) || (userdetails.resource_access==1  && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process'])|| (userType==1 && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process']  && userdetails.uid==auditPlanData.application_lead_auditor)"  style="width:240px;" (click)="downloadInspection(this.id,auditPlanData.inspectionplan_id);openmodal(downloading)" [disabled]="loading" class="btn but-cust green m-b-5 m-r-5"  >
                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                        Download Audit Plan as PDF</button>
                        
                    </mat-expansion-panel>                
                </mat-accordion>
            </div>


            <div style="float:left;width:100%;"  *ngIf="(userType!=2 && ((auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['reviewer_reinitiated']) || (auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['review_in_progress']) || (auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['in_progress']) || (auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['waiting_for_lead_auditor']) || (auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['finalized']) )) && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution')) || !(userType==1 && userdetails.rules.includes('brand_management')) )">
                <mat-accordion >
                    <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                               Reviewer History
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="card-box enq-view">
                        
                            <h3>Reviewer History Details</h3>
                            <mat-accordion *ngFor ="let stage of stage_arr" >
                                <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>
                                           Review {{stage+1}}
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                    <div class="mat-accordion"  >
                                        <div class="card-box enq-view">
                                            <h3>Reviewer : {{ auditPlanData.reviewer_details.reviewer_name}}</h3>
                                           
                                            <table class="table table-bordered col-12" style="font-size:13px;">
                                                <thead>
                                                <tr>
                                                    <th scope="col">Standards</th>
                                                    <th scope="col" width="15%">Unit Name</th>
                                                    <th scope="col">Sub Topic</th>
                                                    <th scope="col">Question</th>
                                                    <th scope="col" class="center">Answer</th>
                                                    <th scope="col">Comment</th>
                                                    <th scope="col" class="center" >Created At</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                    
                                                    <tr *ngFor="let revidata of reviewerhistroy; index as rh;">
                                                    
                                                        <td *ngIf="stage == revidata.review_stage"scope="row" class="center">{{ revidata.standard_label }}</td>
                                                        <td *ngIf="stage == revidata.review_stage">{{ revidata.unit_name}} </td>
                                                        <td *ngIf="stage == revidata.review_stage">{{ revidata.sub_topic}} </td>
                                                        <td *ngIf="stage == revidata.review_stage">{{ revidata.questions }}</td>
                                                        <td *ngIf="stage == revidata.review_stage"class="center" >No</td>
                                                        <td *ngIf="stage == revidata.review_stage">{{ revidata.comment }}</td>
                                                        <td *ngIf="stage == revidata.review_stage"class="center" >{{ revidata.created_at }}</td>
                                                    
                                                    </tr> 
                                                </tbody>
                                            </table>
                                            <div *ngFor="let revnotes of reviewernotes; index as rn">
                                                <div *ngIf="revnotes.stage == stage" class="qustion"> 
                                                <h3 >Note </h3>
                                                <textarea readonly class="md-textarea form-control" [innerHTML]="revnotes.notes"></textarea>
                                                </div>
                                                
                                            </div>	
                                        </div>
                                    </div>
                                </mat-expansion-panel>                
                            </mat-accordion>
                                
                        </div>
                    </mat-expansion-panel>                
                </mat-accordion>
            </div>

        <!-- <div class="un-lst" *ngIf="auditPlanData?.auditreviews" ><h3>Review Details</h3></div> -->
        <div style="float:left;width:100%;"  *ngIf="userType!=2 && (userType==2 || userType==3 || (userType==1 && !userdetails.rules.includes('brand_management')))">
                <mat-accordion *ngFor="let auditreview of auditPlanData.auditreviews; index as i">
                    <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                Risk Assesment Details
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="card-box enq-view">
                        
                            <h3>Reviewer Details</h3>
                            
                            <table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Reviewer</th>
                                    <td width="30%">{{ auditreview.reviewer }}</td>
                                    <th width="20%">Status</th>
                                    <td width="30%">{{ auditreview.status_name }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Created Date &amp; Time</th>
                                    <td width="30%">{{ auditreview.created_at }}</td>
                                    <th width="20%">Review Result</th>
                                    <td width="30%">{{ auditreview.review_result_name }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Comments</th>
                                    <td colspan="3">{{ auditreview.status_comments }}</td>					
                                </tr>

                            </table>
                            

                            <div   >
                                <h3 *ngIf="auditreview?.reviewcomments.length>0">Reviewer Comments</h3>
                                
                                <div class="page-title-box">
                                    <div *ngFor="let reviewcomment of auditreview.reviewcomments; index as i">	
                                        <div class="qustion">
                                        <h5>{{ 1+i }}. {{ reviewcomment.question }}</h5>
                                        {{ reviewcomment.answer }}
                                        <p [innerHTML]="reviewcomment.comment"></p>
                                        </div>
                                    </div>  
                                </div>

                                <h3 *ngIf="auditreview?.unitreviewcomments.length>0">Facility Review Comments</h3>
                                
                                <div class="page-title-box" *ngFor="let unitreviewcomment of auditreview.unitreviewcomments; index as i" >

                                    <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" [expanded]="true">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                Unit: {{ unitreviewcomment.unit_name }}
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        <div *ngFor="let unitreviewcomment of unitreviewcomment.reviews; index as j">	
                                            <div class="qustion">
                                                <h5>{{ 1+j }}. {{ unitreviewcomment.question }}</h5>
                                                {{ unitreviewcomment.answer }}
                                                <p [innerHTML]="unitreviewcomment.comment"></p>
                                            </div>
                                        </div>  
                                    </mat-expansion-panel>

                                </div>
                            </div>
                            
                            
                            
                            
                            
                        </div>
                    </mat-expansion-panel>                
                </mat-accordion>
            </div>






            <div *ngIf="auditPlanData?.history  && userType!=2" style="float:left;width:100%;" >
                <mat-accordion *ngFor="let history of auditPlanData?.history; index as hi">
                    <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                History {{ 1+hi }}
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                <div class="col-sm-12 mat-accordion" >
                    <!--
                    <div class="mat-accordion">
						
                        <div class="card-box enq-view">
                            <h3>Company Details</h3>
                            <ul>
                                <li><span class="label-pad">Company Name</span>   <span class="name-pad">{{ history.company_name }}</span></li>
                                <li><span class="label-pad">Zipcode</span>   <span class="name-pad">{{ history.zipcode }}</span></li>
                                <li><span class="label-pad">Address</span>   <span class="name-pad">{{ history.address }}</span></li>
                                <li><span class="label-pad">Country</span>   <span class="name-pad">{{ history.country_name }}</span></li>
                                <li><span class="label-pad">State</span>   <span class="name-pad">{{ history.state_name }}</span></li>
                                <li><span class="label-pad">City</span>   <span class="name-pad">{{ history.city }}</span></li>								
                            </ul>
                        </div>
						
						
						<div class="card-box enq-view">
							<h3>Company Details</h3>
							<table class="table-secondary m-b-15">
								<tr>
									<th width="20%">Company Name</th>
									<td width="30%">{{ history.company_name }}</td>
									<th width="20%">Zipcode</th>
									<td width="30%">{{ history.zipcode }}</td>
								</tr>
								<tr>
									<th width="20%">Address</th>
									<td width="30%">{{ history.address }}</td>
									<th width="20%">Country</th>
									<td width="30%">{{ history.country_name }}</td>
								</tr>
								<tr>
									<th width="20%">State</th>
									<td width="30%">{{ history.state_name }}</td>
									<th width="20%">City</th>
									<td width="30%">{{ history.city }}</td>
								</tr>

							</table>
						</div>
						
                    </div>
                    -->
                    <div class="mat-accordion"  >
                        <div class="card-box enq-view">
                            <h3>Audit Details</h3>
                            <table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Lead Auditor</th>
                                    <td width="30%">{{ history.application_lead_auditor_name }}</td>
                                    <th width="20%">Quotation Manday(s)</th>
                                    <td width="30%">{{ history.quotation_manday }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Actual Manday(s)</th>
                                    <td width="30%">{{ history.actual_manday }}</td>
                                    <th width="20%">Created By</th>
                                    <td width="30%">{{ history.created_by_name }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Created At</th>
                                    <td width="80%" colspan="3">{{ history.created_at }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="mat-accordion"   >
                        <div class="card-box enq-view">
                            <h3>Customer Review</h3>
                            <table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Created By</th>
                                    <td width="30%">{{ history.customer_review_created_by_name }}</td>
                                    <th width="20%">Created At</th>
                                    <td width="30%">{{ history.customer_review_created_at }}</td>
                                </tr>
                                <tr>                                    
                                    <th width="20%">Comment</th>
                                    <td colspan="3">{{ history.customer_review_comment }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="mat-accordion">
                        <div class="card-box enq-view" style="padding-bottom:20px;"  *ngFor="let unit of history?.units; index as i">
                                
                            <h3>{{ unit.unit_name }}</h3>
							
							<table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Unit Date(s)</th>
                                    <td width="30%" colspan="3"><div *ngFor="let date of unit.date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div></td>								
                                </tr>
                                <tr>
                                    <th width="20%">Quotation Manday(s)</th>
                                    <td width="30%">{{ unit.quotation_manday }}</td>
                                    <th width="20%">Lead Auditor</th>
                                    <td width="30%">{{unit.unit_lead_auditor}}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Actual Manday(s)</th>
                                    <td width="30%">{{unit.actual_manday}}</td>
                                    <th width="20%">Technical Expert</th>
                                    <td width="30%">{{ unit.technical_expert==''?'NA':unit.technical_expert }}</td>								
                                </tr>
                                
                                <tr>
                                    <th width="20%">Translator</th>
                                    <td width="30%">{{ unit.translator==''?'NA':unit.translator }}</td>
                                    <th width="20%">Observer</th>
                                    <td width="30%">{{unit.observer}}</td>								
                                </tr>    
                                <tr>
                                    <th width="20%">Trainee Auditor</th>
                                    <td width="30%">{{unit.trainee_auditor}}</td>
                                </tr>
                            </table>
							
                            <div>
								<!--
                                <ul>
                                    <li><span class="label-pad">Unit Date(s)</span>   <span class="name-pad"><div *ngFor="let date of unit.date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div></span></li>
                                    <li><span class="label-pad">Quotation Manday(s)</span>   <span class="name-pad">{{unit.quotation_manday}}</span></li>
                                    <li><span class="label-pad">Lead Auditor</span>   <span class="name-pad">{{unit.unit_lead_auditor}}</span></li>
                                    <li><span class="label-pad">Actual Manday(s)</span>   <span class="name-pad">{{unit.actual_manday}}</span></li>
                                    <li><span class="label-pad">Technical Expert</span>   <span class="name-pad">{{unit.technical_expert}}</span></li>
                                    <li><span class="label-pad">Translator</span>   <span class="name-pad">{{unit.translator}}</span></li>
                                </ul>
								-->
                                <table class="table table-bordered col-12" style="font-size:13px;">
                                    <thead>
                                    <tr>
                                        <th width="5%" scope="col" class="center">S.No</th>
                                        <th width="20%"scope="col">Auditor</th>
                                        <th scope="col">Date(s)</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let auditor of unit?.auditors; index as is;" >
                                            <td scope="row" class="center"   >{{ 1+is}}</td>
                                            <td >{{ auditor.display_name }}</td>
                                            <td>
                                                <!-- 
                                                <span *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d">{{ date}} </span>
                                                <ng-container *ngIf="last"> &amp; </ng-container> {{ date}}<span *ngIf="!last">, </span> -->
                                                
                                                <div *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div>
                                            </td>
                                        </tr> 
                                    </tbody>
                                </table>
                            
                            
            
                            </div>
                        </div>
                        
                    </div>
            
                    <div style="float:left;width:100%;"  *ngIf="history?.inspectionplan">
                        <mat-accordion>
                            <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        Audit Plan
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="card-box enq-view" >
                                
                                    <h3>Audit Plan Details</h3>
                                    
                                    <div class="mat-accordion">																
										<table class="table-secondary m-b-15">
											<tr>
												<th width="20%">Created By</th>
												<td width="30%">{{ history.inspection_created_by }}</td>
												<th width="20%">Created Date</th>
												<td width="30%">{{ history.inspection_created_at }}</td>
											</tr>
											<tr>
												<th width="20%">Sent By</th>
												<td width="30%">{{ history.inspection_sent_by }}</td>
												<th width="20%">Sent Date</th>
												<td width="30%">{{ history.inspection_sent_at }}</td>
											</tr>									
										</table>								
									</div>
									
                                    <table class="table table-bordered col-12" style="font-size:13px;">
                                        <thead>
                                            <tr>
                                                <th scope="col" class="center" width="5%">S.No</th>
                                                <th scope="col" width="15%">Location</th>
                                                <th scope="col" width="15%">Activity</th>
                                                <th scope="col" width="15%">Inspector</th>
                                                <th scope="col" width="12%" class="center">Date</th>
                                                <th scope="col" width="9%" class="center">Start Time</th>
                                                <th scope="col" width="9%" class="center">End Time</th>
                                                <th scope="col" width="20%">Persons need to be present</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let plans of history?.inspectionplan; index as is">
                                                <td scope="row" class="center">{{ 1+is}}</td>
                                                <td>{{ plans.application_unit_name }}</td>
                                                <td>{{ plans.activity }}</td>
                                                <td>{{ plans.inspector }}</td>
                                                <td class="center">{{ plans.date }}</td>
                                                <td class="center">{{ plans.start_time }}</td>
                                                <td class="center">{{ plans.end_time }}</td>
                                                <td>{{ plans.person_need_to_be_present }}</td>
                                            </tr> 
                                        </tbody>
                                    </table>
                                    
                                    
                                    
                                </div>
                                <!--
                                <button type="button"  *ngIf="(userType==2 && auditPlanData.status >= auditPlanData.arrEnumStatus['awaiting_for_customer_approval']  ) || (userdetails.resource_access==1  && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process'])|| (userType==1 && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process']  && userdetails.uid==auditPlanData.application_lead_auditor)"  style="width:240px;" (click)="downloadInspection(this.id);openmodal(downloading)" [disabled]="loading" class="btn but-cust green m-b-5  m-r-5"  >
                                    <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                    Download Audit Plan as PDF</button>
                                    -->
                            </mat-expansion-panel>                
                        </mat-accordion>
                    </div>
            
                <!-- <div class="un-lst" *ngIf="auditPlanData?.auditreviews" ><h3>Review Details</h3></div> -->
                <div style="float:left;width:100%;">
                        <mat-accordion *ngFor="let auditreview of history.auditreviews; index as i">
                            <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        Risk Assesment Details
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="card-box enq-view">
                                
                                    <h3>Reviewer Details</h3>
                                    <!--
                                    <ul>						
                                        <li><span class="label-pad">Reviewer</span>   <span class="name-pad">{{ auditreview.reviewer }}</span></li>                                        
                                        <li><span class="label-pad">Status</span>   <span class="name-pad">{{ auditreview.status_name }}</span></li>
                                        <li><span class="label-pad">Created Date &amp; Time</span>   <span class="name-pad">{{ auditreview.created_at }}</span></li>
                                        <li style="width:100%;"><span class="label-pad">Review Result</span><span class="name-pad">{{ auditreview.review_result_name }}</span></li>
                                        <li style="width:100%;">
                                            <span class="label-pad" >Comments</span>                                            
                                            <span class="name-pad" [innerHTML]="auditreview.status_comments" ></span>
                                        </li>                                       
                                    </ul>
									-->									
																	
							
									<table class="table-secondary m-b-15">
										<tr>
											<th width="20%">Reviewer</th>
											<td width="30%">{{ auditreview.reviewer }}</td>
											<th width="20%">Status</th>
											<td width="30%">{{ auditreview.status_name }}</td>
										</tr>
										<tr>
											<th width="20%">Created Date &amp; Time</th>
											<td width="30%">{{ auditreview.created_at }}</td>
											<th width="20%">Review Result</th>
											<td width="30%">{{ auditreview.review_result_name }}</td>
										</tr>
										<tr>
											<th width="20%">Comments</th>
											<td colspan="3"><span class="name-pad" [innerHTML]="auditreview.status_comments" ></span></td>											
										</tr>

									</table>
						
                                    
            
                                    <div>
                                        <h3 *ngIf="auditreview?.reviewcomments.length>0">Reviewer Comments</h3>
                                        
                                        <div class="page-title-box">
                                            <div *ngFor="let reviewcomment of auditreview.reviewcomments; index as i">	
                                                <div class="qustion">
                                                <h5>{{ 1+i }}. {{ reviewcomment.question }}</h5>
                                                {{ reviewcomment.answer }}
                                                <p [innerHTML]="reviewcomment.comment"></p>
                                                </div>
                                            </div>  
                                        </div>
            
                                        <h3 *ngIf="auditreview?.unitreviewcomments.length>0">Facility Review Comments</h3>
                                        
                                        <div class="page-title-box" *ngFor="let unitreviewcomment of auditreview.unitreviewcomments; index as i" >
            
                                            <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" [expanded]="true">
                                                <mat-expansion-panel-header>
                                                    <mat-panel-title>
                                                        Unit: {{ unitreviewcomment.unit_name }}
                                                    </mat-panel-title>
                                                </mat-expansion-panel-header>
                                                <div *ngFor="let unitreviewcomment of unitreviewcomment.reviews; index as j">	
                                                    <div class="qustion">
                                                        <h5>{{ 1+j }}. {{ unitreviewcomment.question }}</h5>
                                                        {{ unitreviewcomment.answer }}
                                                        <p [innerHTML]="unitreviewcomment.comment"></p>
                                                    </div>
                                                </div>  
                                            </mat-expansion-panel>
            
                                        </div>
                                    </div>
                                    
                                    
                                    
                                    
                                    
                                </div>
                            </mat-expansion-panel>                
                        </mat-accordion>
                    </div>
            
            
                </div>
                </mat-expansion-panel>                
            </mat-accordion>
            </div>
        <div style="float:left;width:100%;" *ngIf="auditPlanData?.auditoroverduecmt && (auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['nc_overdue_waiting_for_review'] || auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['nc_overdue_failed'])">
                <div class="card-box enq-view">
                    <h3>Auditor NC Overdue Details</h3>                            
                     
                    
                        <table class="table-secondary m-b-15">
                            <tr>
                                <th width="20%">Lead Auditor</th>
                                <td width="30%">{{ auditPlanData.auditoroverduecmt.created_by }}</td>
                                <th width="20%">Created Date &amp; Time</th>
                                <td width="30%">{{ auditPlanData.auditoroverduecmt.created_at }}</td>
                            </tr>
                            <tr>
                                <th width="20%">Comments</th>
                                <td colspan="3"><span class="name-pad" [innerHTML]="auditPlanData.auditoroverduecmt.comment" ></span></td>											
                            </tr>

                        </table>
            
                        

                    
                </div>
        </div>

        <div style="float:left;width:100%;"
            *ngIf="auditPlanData?.revieweroverduecmt && (auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['nc_overdue_failed'])">
        
            <div class="card-box enq-view">
                <h3> Reviewer NC Overdue Details</h3>
                <table class="table-secondary m-b-15">
                    <tr>
                        <th width="20%">Reviewer</th>
                        <td width="30%">{{ auditPlanData.revieweroverduecmt.created_by }}</td>
                        <th width="20%">Created Date &amp; Time</th>
                        <td width="30%">{{ auditPlanData.revieweroverduecmt.created_at }}</td>
                    </tr>
                    <tr>
                        <th width="20%">Comments</th>
                        <td colspan="3"><span class="name-pad" [innerHTML]="auditPlanData.revieweroverduecmt.comment"></span>
                    </td>
                    </tr>
        
                </table>
        
        
        
            </div>
        
        </div>

        </div>














        <!-- Followup Content Starts Here -->
        <div *ngIf="followupdivcontentstatus" class="add card-box table-responsive">



            <div class="col-12 row mat-accordion" *ngIf="userType!=2">
                <div class="card-box enq-view">
                    <h3>Follow-Up Audit Details</h3>
                    <table class="table-secondary">
                        <tr>
                            <th width="20%">Lead Auditor</th>
                            <td width="80%" colspan="3">{{ auditPlanData.followup_application_lead_auditor_name }}</td>
                           
                        </tr>
                        <tr>
                            <th width="20%">Actual Manday(s)</th>
                            <td width="30%">{{ auditPlanData.followup_actual_manday }}</td>
                            <th width="20%">Created By</th>
                            <td width="30%">{{ auditPlanData.followup_created_by_name }}</td>
                        </tr>
                        <tr>
                            <th width="20%">Created At</th>
                            <td width="30%">{{ auditPlanData.followup_created_at }}</td>
                            <th width="20%">Status</th>
                            <td width="30%">{{ auditPlanData.plan_status_name }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="col-12 row mat-accordion m-t-10" *ngIf="auditPlanData.status == auditPlanData.arrEnumStatus['followup_rejected_by_customer']"  >
                <div class="card-box enq-view">
                    <h3>Audit Plan Rejected Details</h3>
                    <table class="table-secondary">
                        <tr>
                            <th width="20%">Rejected By</th>
                            <td width="30%">{{ auditPlanData.followup_customer_review_created_by_name }}</td>
                            
                            <th width="20%">Rejected On</th>
                            <td width="30%">{{ auditPlanData.followup_customer_review_created_at }}</td>
                        </tr>
                        <tr>
                            <th width="20%">Comment</th>
                            <td width="80%" colspan="3">{{ auditPlanData.followup_customer_review_comment }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="col-12 row  mat-accordion m-t-10">
                <ng-container  *ngFor="let unit of auditPlanData?.units; index as i">
                    
                    <ng-container *ngIf="unit.followup_status" >
                        <div class="card-box enq-view" style="padding-bottom:20px;" >
                            <!-- 
                            <h3>{{ unit.unit_name }} [<ng-container *ngFor="let std of unit.standard; let stdi=index;">{{std.standard_name}} <span *ngIf="stdi+1!=unit.standard.length">,</span></ng-container>]</h3>
                            -->
                            <div class="un-lst"><h3>{{ unit.unit_name }}  [<ng-container *ngFor="let std of unit.standard; let stdi=index;">{{std.standard_name}}<span *ngIf="stdi+1!=unit.standard.length">, </span></ng-container>]</h3></div> 
                                            
                            <!-- New Button Code Start Here ------- -->
                            
                            
                            <!--
                            <div *ngIf="unit.followup_status" >				
                                <button type="button" (click)="changeAuditTab('normal',unit.id)" class="btn btn-sm {{normalcontentstatus[unit.id] ? 'btn-success' : 'btn-primary'}}">Normal</button>
                                <button type="button" (click)="changeAuditTab('followup',unit.id)" class="btn btn-sm {{followupcontentstatus[unit.id] ? 'btn-success' : 'btn-primary'}}" style="margin-left:3px;">Follow-Up</button>
                            </div>
                            -->
                                
                            <!--*ngIf="unit.followup_status && followupcontentstatus[unit.id]"-->
                            <div class="col-12 pad-left pad-right">
                                
                                <div>
                                
                                    <table class="table-secondary m-b-15">
                                        <tr>
                                            <th width="20%">Unit Date(s)</th>
                                            <td width="30%" colspan="3"><div *ngFor="let date of unit.followup_date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div></td>
                                            <!--<th width="20%">Quotation Manday(s)</th>
                                            <td width="30%">{{ unit.quotation_manday }}</td>-->
                                        </tr>
                                        <tr>
                                            <th width="20%">Lead Auditor</th>
                                            <td width="30%">{{unit.followup_unit_lead_auditor}}</td>
                                            <th width="20%">Actual Manday(s)</th>
                                            <td width="30%">{{unit.followup_actual_manday}}</td>
                                        </tr>
                                       
                                        <tr>
                                            <th width="20%">Technical Expert</th>
                                            <td width="30%">{{ unit.followup_technical_expert==''?'NA':unit.followup_technical_expert }}</td>
                                            <th width="20%">Translator</th>
                                            <td width="30%">{{ unit.followup_translator==''?'NA':unit.followup_translator }}</td>
                                        </tr>
                                        <tr>
                                            <th width="20%">Observer</th>
                                            <td width="30%">{{unit.followup_observer}}</td>
                                            <th width="20%">Status</th>
                                            <td width="30%">{{unit.status_label}}</td>
                                        </tr>
                                        <tr>
                                            <th width="20%">Status Changed Date</th>
                                            <td colspan="3">{{unit.status_change_date}}</td>
                                        </tr>
                                        <tr>
                                            <th width="20%">Trainee Auditor</th>
                                            <td width="30%">{{unit.followup_trainee_auditor}}</td>
                                        </tr>
                                        <tr *ngIf="auditPlanData.status >= auditPlanData.arrEnumStatus['approved']">
                                            <th width="20%">Total Findings</th>
                                            <td width="30%">{{unit.total_findings}}</td>
                                            <th width="20%">Total Non Conformities</th>
                                            <td width="30%">{{unit.followup_total_non_conformity}}</td>
                                        </tr>
                                    </table>
                                
                                    <table class="table table-bordered col-12" style="font-size:13px;"  *ngIf="userType!=2">
                                        <thead>
                                            <tr>
                                                <th width="5%" scope="col" class="center">S.No</th>
                                                <th width="20%"scope="col">Auditor</th>
                                                <th scope="col">Date(s)</th>								
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let auditor of unit?.followup_auditors; index as is;" >
                                                <td scope="row" class="center"   >{{ 1+is}}</td>
                                                <td >{{ auditor.display_name }} <span *ngIf="auditor.is_justified_user">*</span></td>
                                                <td>
                                                    <!--
                                                    <span *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d">{{ date}} </span>
                                                    <ng-container *ngIf="last"> &amp; </ng-container> {{ date}}<span *ngIf="!last">, </span> 
                                                    -->
                                                    <div *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div>
                                                </td>
                                            </tr> 
                                        </tbody>
                                    </table>
                                    
                                    <table class="table table-bordered col-12" style="font-size:13px;"  *ngIf="userType!=2  && auditPlanData.status >= auditPlanData.arrEnumStatus['approved'] && auditPlanData.status != auditPlanData.arrEnumStatus['rejected']">
                                        <thead>
                                        <tr>
                                            <th scope="col" class="center" width="6%">S.No</th>
                                            <th scope="col">Sub Topic</th>
                                            <th scope="col" class="center">Status</th>
                                            <th scope="col">Reviewed By</th>
                                            <th scope="col" class="center" >Reviewed Date</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let subtopic of unit?.followup_subtopics; index as st;" >
                                                <td scope="row" class="center"   >{{ 1+st}}</td>
                                                <td >{{ subtopic.name }}</td>
                                                <td class="center" >{{ subtopic.status_name }}</td>
                                                <td >{{ subtopic.display_name }}</td>
                                                <td class="center" >{{ subtopic.executed_date }}</td>
                                            </tr> 
                                        </tbody>
                                    </table>				
                                    
                                    <!-- [routerLink]="['/audit/audit-execution']" [queryParams]="{audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.id}"-->
                                    <button type="button" *ngIf="unit.is_followup_subtopic_assigned && (unit.status==auditPlanData.arrUnitEnumStatus['followup_lead_auditor_reinitiated'] || unit.status==auditPlanData.arrUnitEnumStatus['followup_open'] || unit.status==auditPlanData.arrUnitEnumStatus['followup_inprocess'] || unit.status==auditPlanData.arrUnitEnumStatus['followup_awaiting_unit_lead_auditor_approval']) && auditPlanData.status >= auditPlanData.arrEnumStatus['followup_booked'] && auditPlanData.status != auditPlanData.arrEnumStatus['followup_rejected_by_customer'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution') && unit.followup_auditorIds.includes(userdetails.uid) ) ) " (click)="open(executeAuditContent,'followup_executeAudit',{audit_plan_unit_id:unit.id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id},i)"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                    Conduct the Audit</button>
                                    <button type="button" *ngIf="unit.followup_show_assign_subtopic && auditPlanData.status >= auditPlanData.arrEnumStatus['followup_booked'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution') && unit.followup_auditorIds.includes(userdetails.uid) ) ) " (click)="openmodal(assignSubtopic,'followup_assignSubtopic',{audit_plan_unit_id:unit.id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                    Assign SubTopic</button>
                                    <!-- Button For Audit Lead Auditor 
                                    <button type="button" *ngIf="(unit.status==auditPlanData.arrUnitEnumStatus['followup_awaiting_lead_auditor_approval'] || unit.status==auditPlanData.arrUnitEnumStatus['followup_reviewer_reinitated']) && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.followup_application_lead_auditor && userdetails.rules.includes('audit_execution')) ) " (click)="open(executeAuditContent,'followup_executeAudit',{audit_plan_unit_id:unit.id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id},i)"   [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                    Conduct the Audit</button>-->
                                    
                                    <!-- *ngIf="(unit.status==auditPlanData.arrUnitEnumStatus['awaiting_for_lead_auditor_approval']) && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) ) "
                                    <button type="button" *ngIf="(unit.status==auditPlanData.arrUnitEnumStatus['followup_awaiting_lead_auditor_approval']) && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) ) " (click)="open(executeAuditContent,'followup_executeAudit',{audit_plan_unit_id:unit.id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id},i)"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                    Conduct the Audit</button> -->


                                    <button type="button" *ngIf="(userType==1 || userType==2 ) && unit.status>=auditPlanData.arrUnitEnumStatus['followup_awaiting_lead_auditor_approval']" [routerLink]="['/audit/audit-findings']" [queryParams]="{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id,audit_plan_unit_id:unit.id,type:'all'}" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                        View All Checklist
                                    </button>
                                    <!--*ngIf="unit.total_non_conformity>0 && ((userType==2 && (unit.status>=auditPlanData.arrUnitEnumStatus['followup_open'])) ||  (userType==1 && unit.status>=auditPlanData.arrUnitEnumStatus['followup_open'] && unit.status<=auditPlanData.arrUnitEnumStatus['followup_awaiting_reviewer_approval']))"-->
                                    <button type="button" style="width:220px;" *ngIf="unit.total_non_conformity>0 && ((userType==1 || userType==2) && unit.status>=auditPlanData.arrUnitEnumStatus['followup_awaiting_lead_auditor_approval'] && unit.status<=auditPlanData.arrUnitEnumStatus['followup_awaiting_reviewer_approval'])" [routerLink]="['/audit/audit-findings']" [queryParams]="{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id,audit_plan_unit_id:unit.id,type:'nc',nctype:'followup'}" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                        View All Non Conformities
                                    </button>
                                    
                                    <button type="button" *ngIf="(unit.status >= auditPlanData.arrUnitEnumStatus['audit_completed'] || unit.status == auditPlanData.arrUnitEnumStatus['remediation_in_progress']) && (userType==2 || userType==3 || userdetails.resource_access==1 || (userType==1 && (userdetails.rules.includes('audit_execution') || userdetails.rules.includes('assign_as_oss_review_for_tc') || userdetails.rules.includes('report_for_peer_reviewer'))) || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) || (userType==1 && userdetails.uid==auditPlanData.reviewer_id ) || (userType==1 && userdetails.uid==unit.unit_lead_auditor_id && userdetails.rules.includes('audit_execution'))) " [disabled]="loading" class="btn but-cust green m-b-5 ml-2" (click)="downloadunitNCreport(this.id,auditPlanData.id,unit.id);openmodal(downloading)">
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                        Download NC Report
                                    </button>

                                    <ng-container *ngIf="auditPlanData.plan_status >= auditPlanData.arrEnumPlanStatus['audit_completed'] && (userType==2 || userdetails.resource_access==1 ||  (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) || (userType==1 && userdetails.rules.includes('audit_review') )) ">
                                        <button type="button"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  *ngFor="let unitstd of unit.standard; index as i" style="width:auto;" (click)="downloadAuditreport(this.id,auditPlanData.id,unitstd.standard_id,unit.id);openmodal(downloading)">
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                        Download Audit Report for {{unitstd.standard_name}}</button>
                                    </ng-container>	

                                    <!-- *ngIf="unit.status==auditPlanData.arrUnitEnumStatus['awaiting_for_unit_lead_auditor_approval']  && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==unit.unit_lead_auditor_id && userdetails.rules.includes('audit_execution')))"-->
                                    
                                    <button   type="button" *ngIf="unit.status==auditPlanData.arrUnitEnumStatus['followup_awaiting_unit_lead_auditor_approval']  && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==unit.followup_unit_lead_auditor_id && userdetails.rules.includes('audit_execution')))" (click)="open(sendToFollowupLeadAuditorContent,'followup_sendtoleadauditor',{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,unit_id:unit.unit_id,audit_plan_unit_id:unit.id})" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                                        <span *ngIf="loading" class="spinner-border sp
                                        inner-border-sm mr-1"></span>
                                        Submit for Lead Auditor Approval</button>                           

                                    <div *ngIf="successUnitIndex==unit.id" >
                                        <app-usermessage [success]="unitsuccess" [error]="uniterror"  ></app-usermessage>
                                    </div>
                                    
                                </div>					
                                
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
            </div>
            

            <div style="float:left;width:100%;"  *ngIf="auditPlanData?.followupinspectionplan">
                <mat-accordion>
                    <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                Audit Plan
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="card-box enq-view" >
                        
                            <h3>Audit Plan Details</h3>
                            
                            <div class="mat-accordion">																
                                <table class="table-secondary m-b-15">
                                    <tr>
                                        <th width="20%">Created By</th>
                                        <td width="30%">{{ auditPlanData.followupinspection_created_by }}</td>
                                        <th width="20%">Created Date</th>
                                        <td width="30%">{{ auditPlanData.followupinspection_created_at }}</td>
                                    </tr>
                                    <tr>
                                        <th width="20%">Sent By</th>
                                        <td width="30%">{{ auditPlanData.followupinspection_sent_by }}</td>
                                        <th width="20%">Sent Date</th>
                                        <td width="30%">{{ auditPlanData.followupinspection_sent_at }}</td>
                                    </tr>									
                                </table>								
                            </div>
                            
                            <table class="table table-bordered col-12" style="font-size:13px;">
                                <thead>
                                <tr>
                                    <th scope="col" class="center" width="5%">S.No</th>
                                    <th scope="col" width="15%">Location</th>
                                    <th scope="col" width="15%">Activity</th>
                                    <th scope="col" width="15%">Inspector</th>
                                    <th scope="col" width="12%" class="center">Date</th>
                                    <th scope="col" width="9%" class="center">Start Time</th>
                                    <th scope="col" width="9%" class="center">End Time</th>
                                    <th scope="col" width="20%">Persons need to be present</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr  *ngFor="let plans of auditPlanData?.followupinspectionplan; index as is">
                                        <td scope="row" class="center">{{ 1+is}}</td>
                                        <td>{{ plans.application_unit_name }}</td>
                                        <td>{{ plans.activity }}</td>
                                        <td>{{ plans.inspector }}</td>
                                        <td class="center">{{ plans.date }}</td>
                                        <td class="center">{{ plans.start_time }}</td>
                                        <td class="center">{{ plans.end_time }}</td>
                                        <td>{{ plans.person_need_to_be_present }}</td>
                                    </tr> 
                                </tbody>
                            </table>
                            
                        </div>
                        <button type="button"  *ngIf="(userType==2 && auditPlanData.status >= auditPlanData.arrEnumStatus['awaiting_for_customer_approval']  ) || (userdetails.resource_access==1  && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process'])|| (userType==1 && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process']  && userdetails.uid==auditPlanData.application_lead_auditor)"  style="width:240px;" (click)="downloadInspection(this.id,auditPlanData.followupinspectionplan_id);openmodal(downloading)" [disabled]="loading" class="btn but-cust green m-b-5  m-r-5"  >
                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                        Download Audit Plan as PDF</button>
                        
                    </mat-expansion-panel>                
                </mat-accordion>
            </div>

        <!-- <div class="un-lst" *ngIf="auditPlanData?.auditreviews" ><h3>Review Details</h3></div> -->
        <div style="float:left;width:100%;"  *ngIf="userType!=2">
                <mat-accordion *ngFor="let auditreview of auditPlanData.followupauditreviews; index as i">
                    <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                Risk Assesment Details
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="card-box enq-view">
                        
                            <h3>Reviewer Details</h3>
                            <table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Reviewer</th>
                                    <td width="30%">{{ auditreview.reviewer }}</td>
                                    <th width="20%">Status</th>
                                    <td width="30%">{{ auditreview.status_name }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Created Date &amp; Time</th>
                                    <td colspan="3">{{ auditreview.created_at }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Review Result</th>
                                    <td colspan="3">{{ auditreview.review_result_name }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Comments</th>
                                    <td colspan="3">{{ auditreview.status_comments }}</td>
                                </tr>
                            </table>
                            
                            <div>
                                <h3 *ngIf="auditreview?.reviewcomments.length>0">Reviewer Comments</h3>
                                
                                <div class="page-title-box">
                                    <div *ngFor="let reviewcomment of auditreview.reviewcomments; index as i">	
                                        <div class="qustion">
                                        <h5>{{ 1+i }}. {{ reviewcomment.question }}</h5>
                                        {{ reviewcomment.answer }}
                                        <p [innerHTML]="reviewcomment.comment"></p>
                                        </div>
                                    </div>  
                                </div>

                                <h3 *ngIf="auditreview?.unitreviewcomments.length>0">Facility Review Comments</h3>
                                
                                <div class="page-title-box" *ngFor="let unitreviewcomment of auditreview.unitreviewcomments; index as i" >

                                    <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" [expanded]="true">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                Unit: {{ unitreviewcomment.unit_name }}
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        <div *ngFor="let unitreviewcomment of unitreviewcomment.reviews; index as j">	
                                            <div class="qustion">
                                                <h5>{{ 1+j }}. {{ unitreviewcomment.question }}</h5>
                                                {{ unitreviewcomment.answer }}
                                                <p [innerHTML]="unitreviewcomment.comment"></p>
                                            </div>
                                        </div>  
                                    </mat-expansion-panel>

                                </div>
                            </div>
                            
                            
                            
                            
                            
                        </div>
                    </mat-expansion-panel>                
                </mat-accordion>
            </div>






            <div *ngIf="auditPlanData?.followup_history  && userType!=2" style="float:left;width:100%;" >
                <mat-accordion *ngFor="let history of auditPlanData?.followup_history; index as hi">
                    <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                History {{ 1+hi }}
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                <div class="col-sm-12 mat-accordion" >
                    <!--<div class="mat-accordion">
                        <div class="card-box enq-view">
                            <h3>Company Details</h3>
                            <table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Company Name</th>
                                    <td width="30%">{{ history.company_name }}</td>
                                    <th width="20%">Zipcode</th>
                                    <td width="30%">{{ history.zipcode }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Address</th>
                                    <td width="30%">{{ history.address }}</td>
                                    <th width="20%">Country</th>
                                    <td width="30%">{{ history.country_name }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">State</th>
                                    <td width="30%">{{ history.state_name }}</td>
                                    <th width="20%">City</th>
                                    <td width="30%">{{ history.city }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                -->

                    <div class="mat-accordion"  >
                        <div class="card-box enq-view">
                            <h3>Audit Details</h3>
                            <table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Lead Auditor</th>
                                    <td width="30%"  >{{ history.application_lead_auditor_name }}</td>
                                    <th width="20%">Actual Manday(s)</th>
                                    <td width="30%">{{ history.actual_manday }}</td>
                                   <!-- <th width="20%">Quotation Manday(s)</th>
                                    <td width="30%">{{ history.quotation_manday }}</td>-->
                                </tr>
                                <tr>
                                    
                                    <th width="20%">Created By</th>
                                    <td width="30%">{{ history.created_by_name }}</td>
                                    <th width="20%">Created At</th>
                                    <td width="80%" colspan="3">{{ history.created_at }}</td>
                                </tr>
                                 
                            </table>
                        </div>
                    </div>

                    <div class="mat-accordion"   >
                        <div class="card-box enq-view">
                            <h3>Customer Review</h3>
                            <table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Created By</th>
                                    <td width="30%">{{ history.customer_review_created_by_name }}</td>
                                    <th width="20%">Created At</th>
                                    <td width="30%">{{ history.customer_review_created_at }}</td>
                                </tr>
                                <tr>                                    
                                    <th width="20%">Comment</th>
                                    <td colspan="3">{{ history.customer_review_comment }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>


                    <div class="mat-accordion">
                        <div class="card-box enq-view" style="padding-bottom:20px;"  *ngFor="let unit of history?.units; index as i">
                                
                            <h3>{{ unit.unit_name }}</h3>
                            <div>
                                <table class="table-secondary m-b-15">
                                    <tr>
                                        <th width="20%">Unit Date(s)</th>
                                        <td colspan="3">
                                            <div *ngFor="let date of unit.date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div>
                                        </td>  
                                    </tr>
                                    <tr>
                                        <th width="20%">Lead Auditor</th>
                                        <td>{{ unit.unit_lead_auditor }}</td>
                                    
                                        <th width="20%">Actual Manday(s)</th>
                                        <td width="30%">{{ unit.actual_manday }}</td>
                                    </tr>	
                                    <tr>
                                        <th width="20%">Technical Expert</th>
                                        <td width="30%">{{ unit.technical_expert==''?'NA':unit.technical_expert }}</td>
                                        <th width="20%">Translator</th>
                                        <td width="30%">{{ unit.translator==''?'NA':unit.translator }}</td>
                                    </tr>	
                                </table>
                                <table class="table table-bordered col-12" style="font-size:13px;">
                                    <thead>
                                    <tr>
                                        <th width="5%" scope="col" class="center">S.No</th>
                                        <th width="20%"scope="col">Auditor</th>
                                        <th scope="col">Date(s)</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let auditor of unit?.auditors; index as is;" >
                                            <td scope="row" class="center"   >{{ 1+is}}</td>
                                            <td >{{ auditor.display_name }}</td>
                                            <td>
                                                <!-- 
                                                <span *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d">{{ date}} </span>
                                                <ng-container *ngIf="last"> &amp; </ng-container> {{ date}}<span *ngIf="!last">, </span> -->
                                                
                                                <div *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d center" style="width:100px;float:left;">{{ date}}</div>
                                            </td>
                                        </tr> 
                                    </tbody>
                                </table>
                            
                            
            
                            </div>
                        </div>
                        
                    </div>
            
                    <div style="float:left;width:100%;"  *ngIf="history?.inspectionplan">
                        <mat-accordion>
                            <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        Audit Plan
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="card-box enq-view" >
                                
                                    <h3>Audit Plan Details</h3>
                                    
                                    <div class="mat-accordion">																
                                        <table class="table-secondary m-b-15">
                                            <tr>
                                                <th width="20%">Created By</th>
                                                <td width="30%">{{ history.inspection_created_by }}</td>
                                                <th width="20%">Created Date</th>
                                                <td width="30%">{{ history.inspection_created_at }}</td>
                                            </tr>
                                            <tr>
                                                <th width="20%">Sent By</th>
                                                <td width="30%">{{ history.inspection_sent_by }}</td>
                                                <th width="20%">Sent Date</th>
                                                <td width="30%">{{ history.inspection_sent_at }}</td>
                                            </tr>									
                                        </table>								
                                    </div>
                                    
                                    <table class="table table-bordered col-12" style="font-size:13px;">
                                        <thead>
                                            <tr>
                                                <th scope="col" class="center" width="5%">S.No</th>
                                                <th scope="col" width="15%">Location</th>
                                                <th scope="col" width="15%">Activity</th>
                                                <th scope="col" width="15%">Inspector</th>
                                                <th scope="col" width="12%" class="center">Date</th>
                                                <th scope="col" width="9%" class="center">Start Time</th>
                                                <th scope="col" width="9%" class="center">End Time</th>
                                                <th scope="col" width="20%">Persons need to be present</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let plans of history?.inspectionplan; index as is">
                                                <td scope="row" class="center">{{ 1+is}}</td>
                                                <td>{{ plans.application_unit_name }}</td>
                                                <td>{{ plans.activity }}</td>
                                                <td>{{ plans.inspector }}</td>
                                                <td class="center">{{ plans.date }}</td>
                                                <td class="center">{{ plans.start_time }}</td>
                                                <td class="center">{{ plans.end_time }}</td>
                                                <td>{{ plans.person_need_to_be_present }}</td>
                                            </tr> 
                                        </tbody>
                                    </table>
                                    
                                    
                                    
                                </div>
                                <!--
                                <button type="button"  *ngIf="(userType==2 && auditPlanData.status >= auditPlanData.arrEnumStatus['awaiting_for_customer_approval']  ) || (userdetails.resource_access==1  && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process'])|| (userType==1 && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process']  && userdetails.uid==auditPlanData.application_lead_auditor)"  style="width:240px;" (click)="downloadInspection(this.id);openmodal(downloading)" [disabled]="loading" class="btn but-cust green m-b-5 ml-2 m-r-5"  >
                                    <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                    Download Audit Plan as PDF</button>
                                    -->
                            </mat-expansion-panel>                
                        </mat-accordion>
                    </div>
            
                <!-- <div class="un-lst" *ngIf="auditPlanData?.auditreviews" ><h3>Review Details</h3></div> -->
                <div style="float:left;width:100%;">
                        <mat-accordion *ngFor="let auditreview of history.auditreviews; index as i">
                            <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        Risk Assesment Details
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="card-box enq-view">
                                
                                    <h3>Reviewer Details</h3>
                                    
                                    <table class="table-secondary m-b-15">
                                        <tr>
                                            <th width="20%">Reviewer</th>
                                            <td width="30%">{{ auditreview.reviewer }}</td>
                                            <th width="20%">Status</th>
                                            <td width="30%">{{ auditreview.status_name }}</td>
                                        </tr>
                                        <tr>
                                            <th width="20%">Created Date &amp; Time</th>
                                            <td width="30%">{{ auditreview.created_at }}</td>
                                            <th width="20%">Review Result</th>
                                            <td width="30%">{{ auditreview.review_result_name }}</td>
                                        </tr>
                                        <tr>
                                            <th width="20%">Comments</th>
                                            <td colspan="3">{{ auditreview.status_comments }}</td>					
                                        </tr>
        
                                    </table>

                                    
            
                                    <div>
                                        <h3 *ngIf="auditreview?.reviewcomments.length>0">Reviewer Comments</h3>
                                        
                                        <div class="page-title-box">
                                            <div *ngFor="let reviewcomment of auditreview.reviewcomments; index as i">	
                                                <div class="qustion">
                                                <h5>{{ 1+i }}. {{ reviewcomment.question }}</h5>
                                                {{ reviewcomment.answer }}
                                                <p [innerHTML]="reviewcomment.comment"></p>
                                                </div>
                                            </div>  
                                        </div>
            
                                        <h3 *ngIf="auditreview?.unitreviewcomments.length>0">Facility Review Comments</h3>
                                        
                                        <div class="page-title-box" *ngFor="let unitreviewcomment of auditreview.unitreviewcomments; index as i" >
            
                                            <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" [expanded]="true">
                                                <mat-expansion-panel-header>
                                                    <mat-panel-title>
                                                        Unit: {{ unitreviewcomment.unit_name }}
                                                    </mat-panel-title>
                                                </mat-expansion-panel-header>
                                                <div *ngFor="let unitreviewcomment of unitreviewcomment.reviews; index as j">	
                                                    <div class="qustion">
                                                        <h5>{{ 1+j }}. {{ unitreviewcomment.question }}</h5>
                                                        {{ unitreviewcomment.answer }}
                                                        <p [innerHTML]="unitreviewcomment.comment"></p>
                                                    </div>
                                                </div>  
                                            </mat-expansion-panel>
            
                                        </div>
                                    </div>
                                    
                                    
                                    
                                    
                                    
                                </div>
                            </mat-expansion-panel>                
                        </mat-accordion>
                    </div>
            
            
                </div>
                </mat-expansion-panel>                
            </mat-accordion>
            </div>

        </div>



        <!-- Followup Content Ends Here -->




        <div class="card-box enq-view m-t-15">
            <div  *ngIf="error" class="alert alert-danger mt-3 mb-2">{{error}}</div>
            <div  *ngIf="success" class="alert alert-success mt-3 mb-2" >{{success}}</div>
        </div>

		<!--
        <button type="button"  *ngIf="(userType==2 && auditPlanData.status >= auditPlanData.arrEnumStatus['awaiting_for_customer_approval']  ) || (userdetails.resource_access==1  && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process'])|| (userType==1 && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process']  && userdetails.uid==auditPlanData.application_lead_auditor)"  style="width:240px;" (click)="downloadInspection(this.id);openmodal(downloading)" [disabled]="loading" class="btn but-cust green m-b-5 ml-2 m-r-5"  >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Download Audit Plan as PDF</button>
		-->

        <button type="button" *ngIf="(auditPlanData.plan_status >= auditPlanData.arrEnumPlanStatus['audit_completed']  || auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['remediation_in_progress'])&& (userType==2  || userType==3 || userdetails.resource_access==1 || (userType==1 && (userdetails.rules.includes('audit_execution') || userdetails.rules.includes('assign_as_oss_review_for_tc') || userdetails.rules.includes('report_for_peer_reviewer'))) || (userType==1 && userdetails.rules.includes('brand_management')) || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) || (userType==1 && userdetails.uid==auditPlanData.reviewer_id )) " [disabled]="loading" class="btn but-cust green m-b-5 ml-2 mr-2" (click)="downloadNCreport(this.id,auditPlanData.id);openmodal(downloading)">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Download NC Report
        </button>
		
		<!--
        <ng-container *ngIf="auditPlanData.plan_status >= auditPlanData.arrEnumPlanStatus['audit_completed'] && (userType==2 || userdetails.resource_access==1 ||  (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) || (userType==1 && userdetails.rules.includes('audit_review') )) ">
            <button type="button"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  *ngFor="let unitstd of auditPlanData?.units[0].standard; index as i" style="width:auto;" (click)="downloadAuditreport(this.id,auditPlanData.id,unitstd.standard_id);openmodal(downloading)">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Download Audit Report for {{unitstd.standard_name}}</button>
        </ng-container>
		-->
		
        <!--
        <button type="button" *ngIf="auditPlanData.reviewer_id &&  userdetails.resource_access==1" [disabled]="loading" class="btn but-cust green m-b-5 ml-2" (click)="openmodal(changereviewercontent,'')" >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Change Reviewer</button>
        -->
		
        <button  type="button" [routerLink]="['/audit/inspection-plan']" [queryParams]="{audit_id:this.id,audit_plan_id:auditPlanData.id}" *ngIf="(auditPlanData.status == auditPlanData.arrEnumStatus['review_completed'] || auditPlanData.status == auditPlanData.arrEnumStatus['inspection_plan_in_process'] )&& (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) ) " [disabled]="loading" class="btn but-cust green m-b-5 mr-2"  style="width:200px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
			<span *ngIf="auditPlanData?.inspectionplan?.length>0">Update Audit Plan</span>
			<span *ngIf="auditPlanData?.inspectionplan?.length<=0">Generate Audit Plan</span></button>


        <button  type="button" [routerLink]="['/audit/audit-plan']" [queryParams]="{app_id:auditPlanData.app_id,invoice_id:auditPlanData.invoice_id,offer_id:auditPlanData.offer_id,id:auditPlanData.audit_id}" *ngIf="(auditPlanData.status==auditPlanData.arrEnumStatus['open'] || auditPlanData.status==auditPlanData.arrEnumStatus['submitted'] || auditPlanData.status==auditPlanData.arrEnumStatus['rejected'] )&& (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('generate_audit_plan')) ) && auditPlanData.audit_type != 2" [disabled]="loading" class="btn but-cust green m-b-5 m-r-5"  style="width:200px;margin-left:5px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Edit Audit Plan
        </button>
        
        <button  type="button" [routerLink]="['/audit/followup-audit-plan']" [queryParams]="{app_id:auditPlanData.app_id,invoice_id:auditPlanData.invoice_id,offer_id:auditPlanData.offer_id,id:auditPlanData.audit_id,audit_type:auditPlanData.audit_type}" *ngIf="(auditPlanData.status==auditPlanData.arrEnumStatus['open'] || auditPlanData.status==auditPlanData.arrEnumStatus['submitted'] || auditPlanData.status==auditPlanData.arrEnumStatus['rejected'] )&& (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('generate_audit_plan')) ) && auditPlanData.audit_type == 2" [disabled]="loading" class="btn but-cust green m-b-5 m-r-5"  style="width:200px;margin-left:5px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Edit Audit Plan
        </button>

        <!-- Followup Starts -->
        <button  type="button" [routerLink]="['/audit/followup-audit-plan']" [queryParams]="{app_id:auditPlanData.app_id,id:auditPlanData.audit_id,offer_id:auditPlanData.offer_id,audit_type:auditPlanData.audit_type}" *ngIf="(auditPlanData.status==auditPlanData.arrEnumStatus['followup_open'] || auditPlanData.status==auditPlanData.arrEnumStatus['followup_submitted'] || auditPlanData.status==auditPlanData.arrEnumStatus['followup_rejected_by_customer']) && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('generate_audit_plan')) )" [disabled]="loading" class="btn but-cust green m-b-5 m-r-5"  style="width:200px;margin-left:5px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Edit Followup Audit Plan
        </button>
        <button type="button" *ngIf="auditPlanData.status == auditPlanData.arrEnumStatus['followup_submitted'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('generate_audit_plan')) ) " [disabled]="loading" class="btn but-cust green m-b-5" (click)="open(confirmContent,'followupsubmitforreview')" style="width:220px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Confirm Followup Plan</button>
            
        
        <button type="button" [routerLink]="['/audit/audit-plan-checklist']" [queryParams]="{id:this.id,app_id:auditPlanData.app_id}" *ngIf="auditPlanData.status == auditPlanData.arrEnumStatus['followup_review_in_process'] && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.followup_application_lead_auditor && userdetails.rules.includes('audit_execution')) ) " [disabled]="loading" class="btn but-cust green m-b-5 m-l-10"  style="width:250px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Complete Followup Risk Assesment</button>
        
        <button  type="button" [routerLink]="['/audit/inspection-plan']" [queryParams]="{audit_id:this.id,audit_plan_id:auditPlanData.id}" *ngIf="(auditPlanData.status == auditPlanData.arrEnumStatus['followup_review_completed'] || auditPlanData.status == auditPlanData.arrEnumStatus['followup_inspection_plan_inprocess'] )&& (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.followup_application_lead_auditor && userdetails.rules.includes('audit_execution')) ) " [disabled]="loading" class="btn but-cust green m-b-5 m-l-10"  style="width:200px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            <span *ngIf="auditPlanData?.followupinspectionplan?.length>0">Update Followup Audit Plan</span>
            <span *ngIf="auditPlanData?.followupinspectionplan?.length<=0">Generate Followup Audit Plan</span>
        </button>
       
        <button (click)="open(sendInspectionContent,'followup_sendtocustomer',this.id)" *ngIf="(auditPlanData.status == auditPlanData.arrEnumStatus['followup_inspection_plan_inprocess'] )&& (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.followup_application_lead_auditor && userdetails.rules.includes('audit_execution')) ) "  type="button" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:270px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Send Followup Audit Plan to Customer</button>

        <button type="button" (click)="open(approveInspectionContent,'followup_approveinspection',this.id)" *ngIf="(auditPlanData.status == auditPlanData.arrEnumStatus['awaiting_followup_customer_approval'] )&& (userdetails.resource_access==1 || (userType==2 ) ) " [disabled]="loading" class="btn  but-cust  green m-b-5 ml-2"  >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Approve Followup</button>
             
        <button type="button" (click)="open(rejectInspectionContent,'followup_rejectinspection',this.id)" *ngIf="(auditPlanData.status == auditPlanData.arrEnumStatus['awaiting_followup_customer_approval'] )&& (userdetails.resource_access==1 || (userType==2 ) ) "   [disabled]="loading" class="btn  but-cust  red m-b-5 ml-2"   >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Reject Followup</button>
       <!-- Followup Ends -->







        <!-- <button (click)="open(completeInspectionContent,'inspectionplancomplete',unit.id)"  *ngIf="(auditPlanData.status == auditPlanData.arrEnumStatus['inspection_plan_in_process'] )&& (userdetails.resource_access==1 || (userType==1 && userdetails.uid==unit.unit_lead_auditor_id ) ) "  type="button"[disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:200px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Inspection Plan Completed</button> -->
       

        
        <button (click)="open(sendInspectionContent,'sendtocustomer',this.id)" *ngIf="auditPlanData.showsendtocustomer && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) ) "  type="button" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:250px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Send Audit Plan to Customer</button>
        
        <button (click)="open(approveInspectionPlanContent,'approveplanbyauditor',this.id)" *ngIf="auditPlanData.showInspectionApproval && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) ) "  type="button" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:250px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Approve Audit Plan</button>


        <button type="button" (click)="open(approveInspectionContent,'approveinspection',this.id)" *ngIf="(auditPlanData.status == auditPlanData.arrEnumStatus['awaiting_for_customer_approval'] )&& (userdetails.resource_access==1 || (userType==2 ) ) " [disabled]="loading" class="btn  but-cust  green m-b-5 ml-2"  >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Approve</button>
            <!--  -->
        <button type="button" (click)="open(rejectInspectionContent,'rejectinspection',this.id)" *ngIf="(auditPlanData.status == auditPlanData.arrEnumStatus['awaiting_for_customer_approval'] )&& (userdetails.resource_access==1 || (userType==2 ) ) "   [disabled]="loading" class="btn  but-cust  red m-b-5 ml-2"   >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Reject</button>


        
        <button type="button" *ngIf="auditPlanData.status == auditPlanData.arrEnumStatus['submitted'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('generate_audit_plan')) ) " [disabled]="loading" class="btn but-cust green m-b-5" (click)="open(confirmContent,'submitforreview')" style="width:220px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Confirm Plan</button>
            
        <button type="button" [routerLink]="['/audit/audit-plan-checklist']" [queryParams]="{id:this.id,app_id:auditPlanData.app_id}" *ngIf="auditPlanData.status == auditPlanData.arrEnumStatus['review_in_process'] && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) ) " [disabled]="loading" class="btn but-cust green m-b-5"  style="width:250px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Complete Risk Assesment</button>
        



        <!-- After Audit Completed -->
        <button type="button" *ngIf="auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['waiting_for_lead_auditor'] && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution') )) " (click)="open(confirmSubmitForReviewContent,'submitforreviewer',{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Submit to Reviewer</button>

        <button type="button" style="width: 250px;"
            *ngIf="auditPlanData.plan_status < auditPlanData.arrEnumPlanStatus['nc_overdue_waiting_for_review'] && auditPlanData.overdue_status == 2 &&  (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution') ))"
            (click)="open(forwardtoreviewer,'forwardtoreviewer',{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,type:1})"
            [disabled]="loading" class="btn but-cust green m-b-5 ml-2">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Forward NC Overdue to Reviewer</button>
        
        <button type="button" *ngIf="auditPlanData.reviewer_id && (auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['nc_overdue_waiting_for_review']) && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.reviewer_id && userdetails.rules.includes('audit_review') ) )" (click)="open(reviewNCoverdue,'reviewNCoverdue',{app_id:auditPlanData.app_id,audit_plan_id:auditPlanData.id,audit_id:auditPlanData.audit_id,type:2})"
            [disabled]="loading" class="btn but-cust green m-b-5 ml-2">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Review NC Overdue</button>

        <!--  -->
        <button type="button"  *ngIf="!auditPlanData.reviewer_id && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['waiting_for_review'] && (userdetails.resource_access==1 || (auditPlanData.reviewer_canassign && userType==1 && userdetails.rules.includes('audit_review') )) " (click)="open(assignReviewerForm,'assignreviewer',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Assign as Reviewer</button> 
        <!--<button type="button" *ngIf="!auditPlanData.reviewer_id && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['waiting_for_review'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_review') )) " (click)="open(confirmReviewerContent,'assignreviewer',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Assign as Reviewer</button> -->
        
        <button type="button" *ngIf="auditPlanData.showCertificateGenerate ==0 && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['review_completed'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_review') && userdetails.uid==auditPlanData.reviewer_id)) " (click)="open(confirmSendCustomerContent,'sendaudittocustomer',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Send to Customer</button> 

        <button type="button" *ngIf="auditPlanData.reviewer_id && (auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['review_in_progress'] || auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['review_completed']) && (userdetails.resource_access==1 || (userType==1 && userdetails.uid==auditPlanData.reviewer_id && userdetails.rules.includes('audit_review') ) ) " [routerLink]="['/audit/audit-report-review']" [queryParams]="{audit_id:this.id,audit_plan_id:auditPlanData.id}" [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Audit Review</button>
        
        <button type="button" *ngIf="(auditPlanData.showCertificateGenerate==1 || auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['remediation_completed']) && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_review') && userdetails.uid==auditPlanData.reviewer_id)) " (click)="open(confirmGenerateCertficateContent,'generate_certificate',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  >
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Finalize the Report</button>
        
        <button type="button" *ngIf="auditPlanData.showSubmitFollowupAudit && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['reviewer_review_in_progress'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_review') && userdetails.uid==auditPlanData.reviewer_id)) " (click)="open(confirmSendConfirmContent,'sendfollowupaudit',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2" style="width:250px;" >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Submit for Followup Audit</button>
        

        <button type="button" *ngIf="auditPlanData.showSubmitRemediationForAuditor && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['remediation_in_progress'] && (userdetails.resource_access==1 || userType==2) " (click)="open(confirmSendConfirmContent,'sendaudittoauditor',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2" style="width:250px;" >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Submit CAP Report</button> 

        <button type="button" *ngIf="auditPlanData.showSendBackRemediationToCustomer && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['auditor_review_in_progress'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution'))) " (click)="open(confirmSendConfirmContent,'sendbackaudittocustomer',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:250px;">
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Send Back Findings to Customer</button>  

        <button type="button" *ngIf="auditPlanData.showSubmitRemediationForReviewer && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['auditor_review_in_progress'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution'))) " (click)="open(confirmSendConfirmContent,'sendaudittoreviewer',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:250px;" >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Submit Remediation for Review</button> 

        <button type="button" *ngIf="auditPlanData.showSendBackRemediationToAuditor && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['reviewer_review_in_progress'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_review'))) " (click)="open(confirmSendConfirmContent,'sendbackaudittoauditor',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:250px;" >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Send Back Remediation to Auditor</button> 
       

        <button type="button" *ngIf="auditPlanData.showSubmitFollowupRemediationForReviewer && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['followup_waiting_for_lead_auditor'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution'))) " (click)="open(confirmSendConfirmContent,'followup_sendaudittoreviewer',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:320px;" >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Submit Followup Remediation for Review</button> 

        <!---- -->
        <button type="button" *ngIf="auditPlanData.showSendBackFollowupRemediationToLeadAuditor && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['followup_reviewinprogress'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_review'))) " (click)="open(confirmSendConfirmContent,'sendbackfollowupaudittoleadauditor',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:350px;" >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Send Back Followup Remediation to Lead Auditor</button> 
        <button type="button" *ngIf="auditPlanData.showSendBackFollowupRemediationToUnitAuditor && auditPlanData.plan_status && auditPlanData.plan_status == auditPlanData.arrEnumPlanStatus['followup_waiting_for_lead_auditor'] && (userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('audit_execution') && userdetails.uid==auditPlanData.followup_application_lead_auditor  )) " (click)="open(confirmSendConfirmContent,'sendbackfollowupaudittoauditor',{audit_plan_id:auditPlanData.id})"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:300px;" >
                <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
            Send Back Followup Remediation to Auditor</button> 
			
		 
            <button type="button"  *ngIf="auditPlanData.canChangeMaterialComp" class="btn but-cust green m-b-5 m-r-5 m-l-5" (click)="editProduct(productEntryDetails)" style="width:320px;">
			<span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
			Change Product Material Composition
        </button>
    
            
    </div>
    * - Justified User
</div>
<ng-template #reviewNCoverdue let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form>
            <!--
		<div class="form-group">
			<label for="status">Status <span class="text-danger">*</span></label>
			<div class="input-group">
						
				<select name="status" [(ngModel)]="model.status"  class="form-control select2" style="width:120px; display:inline;" >
						<option value="">-- Status --</option>
						<option value="1">Approve</option>
				</select>     
				
			</div>
			<div class="validationerror" *ngIf="status_error"  >Please select the status</div>
        </div>
        -->
            <div class="form-group">
                <label for="status">Comment(s) <span class="text-danger">*</span></label>
                <div class="input-group">

                    <textarea name="comments" [(ngModel)]="model.comments" rows="4"
                        style="width:100%; display:inline;"></textarea>

                    <div class="validationerror" *ngIf="comments_error">Please enter the comment</div>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="checkUserComment('forwarded_to_reviewer')">Save</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
    </div>
</ng-template>

<ng-template #forwardtoreviewer let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form>
            <!--
		<div class="form-group">
			<label for="status">Status <span class="text-danger">*</span></label>
			<div class="input-group">
						
				<select name="status" [(ngModel)]="model.status"  class="form-control select2" style="width:120px; display:inline;" >
						<option value="">-- Status --</option>
						<option value="1">Forwarded to Reviewer</option>
				</select>     
				
			</div>
			<div class="validationerror" *ngIf="status_error"  >Please select the status</div>
        </div>
        -->
            <div class="form-group">
                <label for="status">Comment(s) <span class="text-danger">*</span></label>
                <div class="input-group">

                    <textarea name="comments" [(ngModel)]="model.comments" rows="4"
                        style="width:100%; display:inline;"></textarea>

                    <div class="validationerror" *ngIf="comments_error">Please enter the comment</div>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="checkUserComment('forwarded_to_reviewer')">Save</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
    </div>
</ng-template>

<ng-template #changereviewercontent let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Change Reviewer</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<form>
            <div class="form-group">
                <label for="user_id">User <span class="text-danger">*</span></label>
                <div class="input-group">		
                    <select name="user_id" [(ngModel)]="model.user_id"  class="form-control select2" (change)="getReviewerDetails($event.target.value)">
                            <option value="">-- User --</option>
                            <option *ngFor="let user of revieweruserList" value= {{user.id}}>{{ user.first_name+' '+user.last_name }}</option>
                    </select>
                </div>
                <div class="validationerror" *ngIf="user_id_error"  >Please select the user</div>
            </div>

            <div class="form-group" *ngIf="loadingData['changereviewer']">
                <span class="spinner-border spinner-border-sm mr-1"></span>
            </div>
            <div class="form-group" *ngIf="changeReviewerDetails && changeReviewerDetails.status && (reviewersuccess =='' || reviewersuccess===undefined)">


                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 enq-view ">
                    <div class="form-group row">
                        <div class="col-12">
                            <label>Reviewer Group(s) : </label> 
                            <ng-container *ngIf="changeReviewerDetails.reviewerValidSectors && changeReviewerDetails.reviewerValidSectors.length>0" >
                                <span *ngFor="let validsector of changeReviewerDetails.reviewerValidSectors;" class="txt-bg-3d">{{ validsector }} </span>
                            </ng-container>
                            <ng-container *ngIf="!changeReviewerDetails.reviewerValidSectors || changeReviewerDetails.reviewerValidSectors.length<=0" >
                                <span>Not Valid for any Business Group</span>
                            </ng-container>
                        </div>
                        <div class="col-12" *ngIf="changeReviewerDetails.userbsectordetailslength>0" >
                            <label>Technical Experts for Other Groups </label><br>
                            <table class="table table-bordered auditplanbgsector" style="font-size:13px;">
                                <thead>
                                <tr>
                                    <th class="center" width="5%">S.No</th>
                                    <th width="25%">Business Sector Group</th>
                                    <th>Technical Expert(s)</th>
                                </tr>
                                </thead>
                                <tbody>
                                <ng-container *ngFor="let item of changeReviewerDetails.userbsectordetails | keyvalue; index as i">
                                    <tr  >
                                        <td class="center"> {{1+i}}</td>
                                        <td>
                                            <!--{{ bsec.group_code }}-->
                                            {{ item.value.groupcode }}
                                        </td>
                                        <td>
                                            <!--{{ bsec.technicalexpertlistnames ? bsec.technicalexpertlistnames : 'No Technical Expert Found'}}-->
                                            <ng-container *ngIf="item.value.usernames.length>0">
                                                {{ item.value.usernames.join(', ') }}
                                            </ng-container>
                                            <ng-container *ngIf="item.value.usernames.length<=0">
                                                No User(s) Found
                                            </ng-container>
                                        </td>
                                    </tr>
                                </ng-container>
                            </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <ng-container *ngIf="changeReviewerDetails.userbsectordetailslength>0">
                    <label for="technicalexpert_ids_changed">Technical Expert <span class="text-danger">*</span></label>
                    <div class="input-group">
                        
                        <mat-select placeholder="Technical Expert" name="technicalexpert_ids_changed"  multiple class="form-control select2"   [(ngModel)]="model.technicalexpert_ids_changed" >
                            <mat-select-trigger>
                            <span *ngIf="model.technicalexpert_ids_changed?.length == 1" >{{model.technicalexpert_ids_changed ? getChangeTEValue(model.technicalexpert_ids_changed): ''}}</span>
                            <span *ngIf="model.technicalexpert_ids_changed?.length > 1" class="example-additional-selection">
                                {{model.technicalexpert_ids_changed.length}} {{ 'selected' }}
                            </span>
                            </mat-select-trigger>
                            <mat-option *ngFor="let userdata of changeReviewerDetails.userListArr" [value]="userdata.id">{{userdata.displayname}}</mat-option>
                        </mat-select>
                    </div>
                    <div class="validationerror" *ngIf="changedtechnicalselerror"  >{{changedtechnicalselerror}}</div>
                </ng-container>
            </div>
		</form>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
		<button type="button" class="btn btn-success " (click)="checkUserSel('','change')">Save</button>
	</div>
</ng-template>



<ng-template #confirmFinalizeContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:16px;">
        Are you sure, do you want to finalize the audit?
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
        
    </div>
</ng-template>


<ng-template #confirmGenerateCertficateContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:16px;">
        Are you sure, do you want to generate certificate for the audit?
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
        
    </div>
</ng-template>

<ng-template #confirmSubmitForReviewContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title" *ngIf="audit_report_valid">Confirm</h4>
        <h4 class="modal-title" id="modal-basic-title" *ngIf="!audit_report_valid">{{audit_report_title}}</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>

    <span *ngIf="this.loadingArr['reportvalidation']" class="spinner-border spinner-border-sm mr-1" ></span>
    <div class="modal-body" style="font-size:16px;" *ngIf="audit_report_valid">
        Are you sure, do you want to submit the audit findings for Reviewer?
    </div>
    <ng-container  *ngIf="!audit_report_valid"  >
        <div   [innerHTML]="audit_report_message">
            
        </div>
    </ng-container>
    <div class="modal-footer">
        <button type="button" *ngIf="audit_report_valid" class="btn btn-success " (click)="modal.close()">Ok</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Close</button>
        
    </div>
    <!--<div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:16px;">
        Are you sure, do you want to submit the audit findings for Reviewer?
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
    </div>
    -->
</ng-template>

<ng-template #sendToLeadAuditorContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title" *ngIf="audit_report_valid">Confirm</h4>
        <h4 class="modal-title" id="modal-basic-title" *ngIf="!audit_report_valid">{{audit_report_title}}</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>

    <span *ngIf="this.loadingArr['reportvalidation']" class="spinner-border spinner-border-sm mr-1" ></span>
    <div class="modal-body" style="font-size:16px;" *ngIf="audit_report_valid">
        Are you sure, do you want to submit the unit findings for Lead auditor approval?
    </div>
    <ng-container  *ngIf="!audit_report_valid"  >
        <div   [innerHTML]="audit_report_message">
            
        </div>
    </ng-container>
    <div class="modal-footer">
        <button type="button" *ngIf="audit_report_valid" class="btn btn-success " (click)="modal.close()">Ok</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Close</button>
        
    </div>
</ng-template>

<ng-template #sendToFollowupLeadAuditorContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title" >Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    
    <div class="modal-body" style="font-size:16px;" >
        Are you sure, do you want to submit the unit findings for Lead auditor approval?
    </div>
     
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Close</button>
        
    </div>
</ng-template>

<ng-template #confirmSendCustomerContent let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Confirm</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body" style="font-size:16px;">
			Are you sure, do you want to send the Audit to the customer?
	</div>
	<div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
		
	</div>
</ng-template>

<ng-template #confirmSendConfirmContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:16px;">
           {{ confirmTitle }}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
        
    </div>
</ng-template>



<ng-template #confirmContent let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Confirm</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body" style="font-size:16px;">
			Are you sure, do you want to submit the Audit Plan for review?
	</div>
	<div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
		
	</div>
</ng-template>
<ng-template #confirmReviewerContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:16px;">
            Are you sure, do you want to assign this audit to you as reviewer?
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
        
    </div>
</ng-template>

<ng-template #completeInspectionContent let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Confirm</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body" style="font-size:16px;">
		Are you sure, do you want to complete the Audit Plan for the unit?
	</div>
	<div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
		
	</div>
</ng-template>
<ng-template #approveInspectionPlanContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Confirm</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:16px;">
        Are you sure, do you want to Approve the Audit Plan ?
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
</div>
</ng-template>

<ng-template #sendInspectionContent let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Confirm</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body" style="font-size:16px;">
		Are you sure, do you want to send the Audit Plan to the customer?
	</div>
	<div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
		
	</div>
</ng-template>
<ng-template #approveInspectionContent let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Confirm</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body" style="font-size:16px;">
			Are you sure, do you want to approve the Audit Plan for this Audit?
	</div>
	<div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="modal.close()">Ok</button>
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
		
	</div>
</ng-template>
<ng-template #rejectInspectionContent let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Confirm</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body" style="font-size:16px;">
		<form>
			<div class="form-group">
				<label for="comments">Comments</label>
				<div class="input-group">
					<textarea name="comments" [(ngModel)]="model.comments" class="form-control" placeholder="Comments"  ></textarea>
				</div>
				<div class="validationerror" *ngIf="comments_error"  >Please enter the comments</div>
			</div>
		</form>
	</div>
	<div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="checkUserComment('reject_inspection')">Submit</button>
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
		
	</div>
</ng-template>

<ng-template #executeAuditContent let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Subtopic</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:16px;">
        <form>
            <div class="form-group">
                <label for="subtopic">Subtopic</label>
                <div class="input-group">
                    
                    <mat-select placeholder="Subtopic *" name="subtopic"  multiple class="form-control select2"   [(ngModel)]="model.subtopic" >
                        <mat-select-trigger>
                        <span *ngIf="model.subtopic?.length == 1" >{{model.subtopic ? getSelectedValue(model.subtopic): ''}}</span>
                        <span *ngIf="model.subtopic?.length > 1" class="example-additional-selection">
                            {{model.subtopic.length}} {{ 'selected' }}
                        </span>
                        </mat-select-trigger>
                        <mat-option *ngFor="let subtopicd of subTopicList" [value]="subtopicd.id">{{subtopicd.name}}</mat-option>
                    </mat-select>

                    
                    <!--
                    <select name="subtopic" class="form-control select2" [(ngModel)]="model.subtopic" >
                        <option value="" >-- select --</option>
                        <option *ngFor="let answer of subTopicList; " value="{{answer.id}}" >{{ answer.name }}</option>
                    </select>
                    -->
                    <span *ngIf="this.loadingData['subtopic']" class="spinner-border spinner-border-sm mr-1"></span>
                    
                </div>
                <div class="validationerror" *ngIf="subtopic_error"  >Please select the subtopic</div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success " (click)="checkSubTopic()">Submit</button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Cancel</button>
    </div>
</ng-template>

<ng-template #assignSubtopic let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Subtopic</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:16px;">
        <form>
            <div class="form-group" *ngIf="assignSubtopicsuccess =='' || assignSubtopicsuccess===undefined">
                <label for="assign_subtopic">Subtopic</label>
                <div class="input-group">
                    
                    <mat-select placeholder="Subtopic *" name="assign_subtopic"  multiple class="form-control select2"   [(ngModel)]="model.assign_subtopic" >
                        <mat-select-trigger>
                        <span *ngIf="model.assign_subtopic?.length == 1" >{{model.assign_subtopic ? getSelectedValue(model.assign_subtopic): ''}}</span>
                        <span *ngIf="model.assign_subtopic?.length > 1" class="example-additional-selection">
                            {{model.assign_subtopic.length}} {{ 'selected' }}
                        </span>
                        </mat-select-trigger>
                        <mat-option *ngFor="let subtopicd of subTopicList" [value]="subtopicd.id">{{subtopicd.name}}</mat-option>
                    </mat-select>

                    <span *ngIf="this.loadingData['subtopic']" class="spinner-border spinner-border-sm mr-1"></span>
                    
                </div>
                <div class="validationerror" *ngIf="assign_subtopic_error"  >Please select the subtopic</div>
            </div>
        </form>
        <app-usermessage [success]="assignSubtopicsuccess" [error]="assignSubtopicerror"  ></app-usermessage>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="assignSubTopic()">
            <span *ngIf="loadingArr['assignSubtopic']" class="spinner-border spinner-border-sm mr-1"></span>
        Submit
        </button>
        <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">
            <span *ngIf="loadingArr['assignSubtopic']" class="spinner-border spinner-border-sm mr-1"></span>
        Cancel
        </button>
    </div>
</ng-template>

<ng-template #downloading let-modal>
    <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">File Downloading</h4>
    </div>
    <div class="modal-body" style="font-size:16px;">
            Please wait, your file is downloading ...
    </div>
</ng-template>

<ng-template #assignReviewerForm let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Assign as Reviewer</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span class="c-icon" aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="font-size:13px;">
        <form>
            <div class="form-group" *ngIf="!assignReviewerDetails || !assignReviewerDetails.status">
                <span class="spinner-border spinner-border-sm mr-1"></span>
            </div>
            <div class="form-group" *ngIf="assignReviewerDetails && assignReviewerDetails.status && (reviewersuccess =='' || reviewersuccess===undefined)">


                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 enq-view ">
                    <div class="form-group row">
                        <div class="col-12">
                            <label>Reviewer Group(s) : </label> 
                            <ng-container *ngIf="assignReviewerDetails.reviewerValidSectors && assignReviewerDetails.reviewerValidSectors.length>0" >
                                <span *ngFor="let validsector of assignReviewerDetails.reviewerValidSectors;" class="txt-bg-3d">{{ validsector }} </span>
                            </ng-container>
                            <ng-container *ngIf="!assignReviewerDetails.reviewerValidSectors || assignReviewerDetails.reviewerValidSectors.length<=0" >
                                <span>Not Valid for any Business Group</span>
                            </ng-container>
                        </div>
                        <div class="col-12" *ngIf="assignReviewerDetails.userbsectordetailslength>0" >
                            <label>Technical Experts for Other Groups </label><br>
                            <table class="table table-bordered auditplanbgsector" style="font-size:13px;">
                                <thead>
                                <tr>
                                    <th class="center" width="5%">S.No</th>
                                    <th width="25%">Business Sector Group</th>
                                    <th>Technical Expert(s)</th>
                                </tr>
                                </thead>
                                <tbody>
                                <ng-container *ngFor="let item of assignReviewerDetails.userbsectordetails | keyvalue; index as i">
                                    <tr  >
                                        <td class="center"> {{1+i}}</td>
                                        <td>
                                            <!--{{ bsec.group_code }}-->
                                            {{ item.value.groupcode }}
                                        </td>
                                        <td>
                                            <!--{{ bsec.technicalexpertlistnames ? bsec.technicalexpertlistnames : 'No Technical Expert Found'}}-->
                                            <ng-container *ngIf="item.value.usernames.length>0">
                                                {{ item.value.usernames.join(', ') }}
                                            </ng-container>
                                            <ng-container *ngIf="item.value.usernames.length<=0">
                                                No User(s) Found
                                            </ng-container>
                                        </td>
                                    </tr>
                                </ng-container>
                            </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <ng-container  *ngIf="assignReviewerDetails.userbsectordetailslength>0" >
                    <label for="technicalexpert_ids">Technical Expert <span class="text-danger">*</span></label>
                    <div class="input-group">
                        
                        <mat-select placeholder="Technical Expert" name="technicalexpert_ids"  multiple class="form-control select2"   [(ngModel)]="model.technicalexpert_ids" >
                            <mat-select-trigger>
                            <span *ngIf="model.technicalexpert_ids?.length == 1" >{{model.technicalexpert_ids ? getSelectedTEValue(model.technicalexpert_ids): ''}}</span>
                            <span *ngIf="model.technicalexpert_ids?.length > 1" class="example-additional-selection">
                                {{model.technicalexpert_ids.length}} {{ 'selected' }}
                            </span>
                            </mat-select-trigger>
                            <mat-option *ngFor="let userdata of assignReviewerDetails.userListArr" [value]="userdata.id">{{userdata.displayname}}</mat-option>
                        </mat-select>
                    </div>
                    <div class="validationerror" *ngIf="technicalselerror"  >{{technicalselerror}}</div>
                </ng-container>
            </div>
        </form>
    </div>

    <app-usermessage [success]="reviewersuccess" [error]="reviewererror"  ></app-usermessage>

    <div class="modal-footer">
        <button type="button" class="btn btn-success " [disabled]="loadingArr['addAssignReviewer']"  (click)="addReviewerwithte()">
            <span *ngIf="loadingArr['addAssignReviewer']" class="spinner-border spinner-border-sm mr-1"></span>
            Submit</button>
        <button type="button" class="btn btn-outline-secondary" [disabled] = "loadingArr['addAssignReviewer']" (click)="modal.dismiss('cancel click')">
            <span *ngIf="loadingArr['addAssignReviewer']" class="spinner-border spinner-border-sm mr-1"></span>
            Cancel</button>
    </div>
</ng-template>

<ng-template #productEntryDetails let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title"> Change Product Material Composition</h4>		
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
			<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	
	<div class="modal-body" *ngIf="auditPlanData">
		<app-application-product-list [id]="auditPlanData.app_id"></app-application-product-list>				
	</div>
	
	<div class="modal-footer"  >
		<button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Close</button>
	</div>	
	
</ng-template>