<div class="row">
    <div class="col-sm-12">
        <div class="page-title-box p-b-30">
            <div class="col-6" style="padding-left:0px;" >
            <h4 class="page-title">View Certificate Details</h4></div>
            <div class="text-right float-right col-6">
                <a class="btn btn-secondary btn-sm active" href="#" role="button" [routerLink]="['/certification/certificate-list']" >Back</a>
            </div>
        </div>	
    </div>
</div>

<div class="row m-t-15">	
	<mat-accordion *ngIf="auditPlanData">
		<mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
			<mat-expansion-panel-header>
				<mat-panel-title>
				View Application Details
				</mat-panel-title>
			</mat-expansion-panel-header>
			
			<div class="row">
				<div class="col-sm-12">
					<div class="clearfix"></div>			
					<app-appdetail [id]="auditPlanData.app_id" ></app-appdetail>							
				</div>				
			</div>

		</mat-expansion-panel>                
	</mat-accordion>

	<div *ngIf="product_addition_id">
		<mat-accordion>
			<mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
				<mat-expansion-panel-header>
					<mat-panel-title>
					View Audit Plan Details
					</mat-panel-title>
				</mat-expansion-panel-header>
				
				<div class="row" *ngIf="id" >
					<div class="col-sm-12">
						<div class="clearfix"></div>            
						<app-auditdetail [id]="auditPlanData.audit_id" ></app-auditdetail>                            
					</div>              
				</div>

			</mat-expansion-panel>                
		</mat-accordion>
	</div>
	
</div>
<div class="row" style="padding-top:20px;" *ngIf="loading"  ><span class="spinner-border spinner-border-sm mr-1"></span></div>
<div class="row" style="padding-top:20px;" *ngIf="auditPlanData"  >
    <div class="col-sm-12 mat-accordion">
	    <div class="mat-accordion">
            <div class="card-box enq-view">
                <h3>Certificate Details</h3>
                <table class="table-secondary m-b-15">
					<tr>
						<th width="20%">Status</th>
						<td width="30%">{{ auditPlanData.certificate_status_name }}</td>
						<th width="20%">Certificate Version</th>
						<td width="30%">{{ auditPlanData.version }}</td>
                    </tr>
                    <tr>
						<th width="20%">Certified Date</th>
						<td width="30%">{{ auditPlanData.certificate_generated_date }}</td>
						<th width="20%">Valid Until</th>
						<td width="30%">{{ auditPlanData.certificate_valid_until }}</td>
                    </tr>
                    <tr>
						<th width="20%">Generated By</th>
						<td width="30%">{{ auditPlanData.creator }}</td>
						<th width="20%">Generated On</th>
						<td width="30%">{{ auditPlanData.created_at }}</td>
					</tr>
                </table>
            </div>
        </div>
		
		<!--
		<ng-container *ngIf="auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['certificate_generated'] && (userType==2 || userdetails.resource_access==1 ||  (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) || (userType==1 && userdetails.rules.includes('audit_review') || (userType==1 && userdetails.rules.includes('view_certificate')) )) ">
            <div class="text-right">
				<button type="button"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  *ngFor="let unitstd of auditPlanData?.units[0].standard; index as i" style="width:auto;" (click)="showCertificatedraft(unitstd.standard_id,'pdf');openmodal(downloading);">
				<span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
				Download Certificate for {{unitstd.standard_name}}</button>
			</div>
        </ng-container>
		-->
		
		<ng-container *ngIf="(auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['certificate_generated'] || auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['expired'] || auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['extension']) && (userType==3 || userType==2 || userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('certification_review') || (userType==1 && userdetails.rules.includes('view_certificate')) )) ">
            <div class="text-right">
				<button type="button"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  style="width:auto;" (click)="showCertificatedraft(auditPlanData.standard_id,'pdf');openmodal(downloading);">
				<span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
				Download Certificate for {{auditPlanData.standard_name}}</button>
			</div>
        </ng-container>
        
		<div class="clearfix"></div>        
		<div style="margin-bottom:20px;" *ngIf="!product_addition_id">
			<div class="row" *ngIf="id" >
				<div class="col-sm-12">
					    
					<app-auditdetail [id]="auditPlanData.audit_id" ></app-auditdetail>                            
				</div>              
			</div>			
        </div>
        
        <div class="mat-accordion" *ngIf="auditPlanData.certificate_status_name == 'Extension'">
            <div class="card-box enq-view">
                <h3>Extension Details</h3>
                <table class="table-secondary m-b-15">
					<tr>
						<th width="20%">Extension Date</th>
						<td width="30%">{{ auditPlanData.extension_date }}</td>
						<th width="20%">Extension By</th>
						<td width="30%">{{ auditPlanData.extension_by }}</td>
                    </tr>
                </table>
            </div>
        </div>
		
		<div *ngIf="product_addition_id" style="margin-bottom:10px; margin-top:10px;">
			<!--<div class="un-lst"><h3>Product Addition Details</h3></div>-->
			<div class="row">
				<div class="col-sm-12">
					<div class="clearfix"></div>            
					<app-productadditiondetail [id]="product_addition_id" ></app-productadditiondetail>                          
				</div>              
			</div>				
		</div>
		
		<!--
        <div class="mat-accordion">
            <div class="card-box enq-view">
                <h3>Company Details</h3>
                <ul>
                    <li><span class="label-pad">Company Name</span>   <span class="name-pad">{{ auditPlanData.company_name }}</span></li>
                    <li><span class="label-pad">Zipcode</span>   <span class="name-pad">{{ auditPlanData.zipcode }}</span></li>
                    <li><span class="label-pad">Address</span>   <span class="name-pad">{{ auditPlanData.address }}</span></li>
                    <li><span class="label-pad">Country</span>   <span class="name-pad">{{ auditPlanData.country_name }}</span></li>
                    <li><span class="label-pad">State</span>   <span class="name-pad">{{ auditPlanData.state_name }}</span></li>
                    <li><span class="label-pad">City</span>   <span class="name-pad">{{ auditPlanData.city }}</span></li>								
                </ul>
            </div>
        </div>
        <div class="mat-accordion" *ngIf="userType!=2">
            <div class="card-box enq-view">
                <h3>Audit Details</h3>
                <ul>
                    <li><span class="label-pad">Lead Auditor</span>   <span class="name-pad">{{ auditPlanData.application_lead_auditor_name }}</span></li>
                    <li><span class="label-pad">Quotation Manday(s)</span>   <span class="name-pad">{{ auditPlanData.quotation_manday }}</span></li>
                    <li><span class="label-pad">Actual Manday(s)</span>   <span class="name-pad">{{ auditPlanData.actual_manday }}</span></li>
                    <li><span class="label-pad">Created By</span>   <span class="name-pad">{{ auditPlanData.created_by_name }}</span></li>
                    <li><span class="label-pad">Created At</span>   <span class="name-pad">{{ auditPlanData.created_at }}</span></li>
                    <li><span class="label-pad">Status</span>   <span class="name-pad">{{ auditPlanData.plan_status_name }}</span></li>								
                </ul>
            </div>
        </div>
        <div class="mat-accordion" >
            <div class="card-box enq-view" style="padding-bottom:20px;"  *ngFor="let unit of auditPlanData?.units; index as i">
                    
                <h3>{{ unit.unit_name }} [<ng-container *ngFor="let std of unit.standard; let stdi=index;">{{std.standard_name}} <span *ngIf="stdi+1!=unit.standard.length">,</span></ng-container>]</h3>
                <div>
                    <ul>
                        <li><span class="label-pad">Unit Date(s)</span>   <span class="name-pad">{{ unit.date.join(', ')}}</span></li>
                        <li><span class="label-pad">Quotation Manday(s)</span>   <span class="name-pad">{{unit.quotation_manday}}</span></li>
                        <li><span class="label-pad">Lead Auditor</span>   <span class="name-pad">{{unit.unit_lead_auditor}}</span></li>
						<li><span class="label-pad">Actual Manday(s)</span>   <span class="name-pad">{{unit.actual_manday}}</span></li>
                        <li><span class="label-pad">Technical Expert</span>   <span class="name-pad">{{unit.technical_expert}}</span></li>
                        <li><span class="label-pad">Translator</span>   <span class="name-pad">{{unit.translator}}</span></li>
						<li><span class="label-pad">Observer</span>   <span class="name-pad">{{unit.observer}}</span></li>
						<li><span class="label-pad">Status</span>   <span class="name-pad">{{unit.status_label}}</span></li>
                        <li><span class="label-pad">Status Changed Date</span>   <span class="name-pad">{{unit.status_change_date}}</span></li>

                        <li  *ngIf="auditPlanData.status >= auditPlanData.arrEnumStatus['approved']"><span class="label-pad">Total Findings</span>   <span class="name-pad">{{unit.total_findings}}</span></li>
                        <li *ngIf="auditPlanData.status >= auditPlanData.arrEnumStatus['approved']"><span class="label-pad"  >Total Non Conformities</span>   <span class="name-pad">{{unit.total_non_conformity}}</span></li>

                    </ul>
                    <table class="table table-bordered col-12" style="font-size:13px;"  *ngIf="userType!=2">
                        <thead>
                        <tr>
                            <th scope="col" class="center" width="6%">S.No</th>
                            <th scope="col" >Auditor</th>
                            <th scope="col" >Date(s)</th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let auditor of unit?.auditors; index as is;" >
                                <td scope="row" class="center"   >{{ 1+is}}</td>
                                <td >{{ auditor.display_name }}</td>
                                <td>
                                    <span *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d">{{ date}} </span>
                                   
                                </td>
                            </tr> 
                        </tbody>
                    </table>
					
					<table class="table table-bordered col-12" style="font-size:13px;"  *ngIf="userType!=2  && auditPlanData.status >= auditPlanData.arrEnumStatus['approved']">
                        <thead>
                        <tr>
                            <th scope="col" class="center" width="6%">S.No</th>
                            <th scope="col">Sub Topic</th>
                            <th scope="col" class="center">Status</th>
							<th scope="col">Reviewed By</th>
							<th scope="col" class="center" >Reviewed Date</th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let subtopic of unit?.subtopics; index as st;" >
                                <td scope="row" class="center"   >{{ 1+st}}</td>
                                <td >{{ subtopic.name }}</td>
                                <td class="center" >{{ subtopic.status_name }}</td>
								<td >{{ subtopic.display_name }}</td>
								<td class="center" >{{ subtopic.executed_date }}</td>
                            </tr> 
                        </tbody>
                    </table>				                                        

                    <div *ngIf="successUnitIndex==unit.id" >
                        <app-usermessage [success]="unitsuccess" [error]="uniterror"  ></app-usermessage>
                    </div>
                    
                </div>
            </div>
            
        </div>

        <div style="float:left;width:100%;"  *ngIf="auditPlanData?.inspectionplan">
            <mat-accordion>
                <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Audit Plan
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="card-box enq-view" >
                    
                        <h3>Audit Plan Details</h3>
                        
                        <table class="table table-bordered col-12" style="font-size:13px;">
                            <thead>
                            <tr>
                                <th scope="col" class="center" width="5%">S.No</th>
								<th scope="col" width="15%">Location</th>
                                <th scope="col" width="15%">Activity</th>
                                <th scope="col" width="15%">Inspector</th>
                                <th scope="col" width="12%" class="center">Date</th>
                                <th scope="col" width="9%" class="center">Start Time</th>
                                <th scope="col" width="9%" class="center">End Time</th>
                                <th scope="col" width="20%">Persons need to be present</th>
                            </tr>
                            </thead>
                            <tbody>
                                <tr  *ngFor="let plans of auditPlanData?.inspectionplan; index as is">
                                    <td scope="row" class="center">{{ 1+is}}</td>
									<td>{{ plans.application_unit_name }}</td>
                                    <td>{{ plans.activity }}</td>
                                    <td>{{ plans.inspector }}</td>
                                    <td class="center">{{ plans.date }}</td>
                                    <td class="center">{{ plans.start_time }}</td>
                                    <td class="center">{{ plans.end_time }}</td>
                                    <td>{{ plans.person_need_to_be_present }}</td>
                                </tr> 
                            </tbody>
                        </table>
                        
                    </div>
                    
                </mat-expansion-panel>                
            </mat-accordion>
        </div>

       
       <div style="float:left;width:100%;"  *ngIf="userType!=2">
            <mat-accordion *ngFor="let auditreview of auditPlanData.auditreviews; index as i">
                <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Risk Assesment Details
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="card-box enq-view">
                    
                        <h3>Reviewer Details</h3>
                        
                        <ul>						
                            <li><span class="label-pad">Reviewer</span>   <span class="name-pad">{{ auditreview.reviewer }}</span></li>
                            <li><span class="label-pad">Answer</span>   <span class="name-pad">{{ auditreview.answer_name }}</span></li>				
                            <li><span class="label-pad">Status</span>   <span class="name-pad">{{ auditreview.status_name }}</span></li>
                            <li><span class="label-pad">Created Date &amp; Time</span>   <span class="name-pad">{{ auditreview.created_at }}</span></li>
                            <li style="width:100%;"><span class="label-pad">Review Result</span><span class="name-pad">{{ auditreview.review_result_name }}</span></li>
                            <li style="width:100%;">
                                <span class="label-pad" >Comments</span>                               
                                <span class="name-pad" [innerHTML]="auditreview.status_comments" ></span>
                            </li>

                            
                        </ul>	
                        

                        <div   >
                            <h3 *ngIf="auditreview?.reviewcomments.length>0">Reviewer Comments</h3>
                            
                            <div class="page-title-box">
                                <div *ngFor="let reviewcomment of auditreview.reviewcomments; index as i">	
                                    <div class="qustion">
                                    <h5>{{ 1+i }}. {{ reviewcomment.question }}</h5>
                                    {{ reviewcomment.answer }}
                                    <p [innerHTML]="reviewcomment.comment"></p>
                                    </div>
                                </div>  
                            </div>

                            <h3 *ngIf="auditreview?.unitreviewcomments.length>0">Facility Review Comments</h3>
                            
                            <div class="page-title-box" *ngFor="let unitreviewcomment of auditreview.unitreviewcomments; index as i" >

                                <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" [expanded]="true">
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>
                                            Unit: {{ unitreviewcomment.unit_name }}
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                    <div *ngFor="let unitreviewcomment of unitreviewcomment.reviews; index as j">	
                                        <div class="qustion">
                                            <h5>{{ 1+j }}. {{ unitreviewcomment.question }}</h5>
                                            {{ unitreviewcomment.answer }}
                                            <p [innerHTML]="unitreviewcomment.comment"></p>
                                        </div>
                                    </div>  
                                </mat-expansion-panel>

                            </div>
                        </div>
                        
                        
                        
                        
                        
                    </div>
                </mat-expansion-panel>                
            </mat-accordion>
        </div>
		-->

        <div style="float:left;width:100%;"  *ngIf="userType!=2 && auditPlanData?.checklistreviews">
            <mat-accordion >
                <!--*ngFor="let auditreview of auditPlanData.checklistreviews; index as i"-->
                <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Certification Checklist Details
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="card-box enq-view">
                    
                        <h3>Checklist Details</h3>
                        <table class="table-secondary m-b-15">
                            <tr>
                                <th width="20%">Reviewer</th>
                                <td width="30%">{{ auditPlanData?.checklistreviews.reviewer }}</td>
                                <th width="20%">Status</th>
                                <td width="30%">{{ auditPlanData?.checklistreviews.answer_name }}</td>
                            </tr>
                            <tr>
                                <th width="20%">Created Date &amp; Time</th>
                                <td width="30%">{{ auditPlanData?.checklistreviews.created_at }}</td>
                                <th width="20%">Comments</th>
                                <td width="30%">{{ auditPlanData?.checklistreviews.risk_comments }}</td>
                            </tr>
                        </table>

                        <div>
                            <h3 *ngIf="auditPlanData?.checklistreviews?.checklistcomments?.length>0">Reviewer Comments</h3>
                            
                            <div class="page-title-box">
                                <div *ngFor="let reviewcomment of auditPlanData?.checklistreviews?.checklistcomments; index as i">	
                                    <div class="qustion">
                                    <h5>{{ 1+i }}. {{ reviewcomment.question }}</h5>
                                    {{ reviewcomment.answer }}
                                    <p [innerHTML]="reviewcomment.comment"></p>
                                    </div>
                                </div>  
                            </div>
                        </div>
                     
                    </div>
                </mat-expansion-panel>                
            </mat-accordion>
        </div>





        <div *ngIf="auditPlanData?.history  && userType!=2" style="float:left;width:100%;" >
            <mat-accordion *ngFor="let history of auditPlanData?.history; index as hi">
                <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            History {{ 1+hi }}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
            <div class="col-sm-12 mat-accordion" >
                <div class="mat-accordion">
                    <div class="card-box enq-view">
                        <h3>Company Details</h3>
                        <table class="table-secondary m-b-15">
                            <tr>
                                <th width="20%">Company Name</th>
                                <td width="30%">{{ history.company_name }}</td>
                                <th width="20%">Zipcode</th>
                                <td width="30%">{{ history.zipcode }}</td>
                            </tr>
                            <tr>
                                <th width="20%">Address</th>
                                <td width="30%">{{ history.address }}</td>
                                <th width="20%">Country</th>
                                <td width="30%">{{ history.country_name }}</td>
                            </tr>
                            <tr>
                                <th width="20%">State</th>
                                <td width="30%">{{ history.state_name }}</td>
                                <th width="20%">City</th>
                                <td width="30%">{{ history.city }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="mat-accordion">
                    <div class="card-box enq-view" style="padding-bottom:20px;"  *ngFor="let unit of history?.units; index as i">
                            
                        <h3>{{ unit.unit_name }}</h3>
                        <div>
                            <table class="table-secondary m-b-15">
                                <tr>
                                    <th width="20%">Unit Date(s)</th>
                                    <td width="30%">{{ unit.date.join(', ')}}</td>
                                    <th width="20%">Quotation Manday(s)</th>
                                    <td width="30%">{{unit.quotation_manday}}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Lead Auditor</th>
                                    <td width="30%">{{ unit.unit_lead_auditor }}</td>
                                    <th width="20%">Actual Manday(s)</th>
                                    <td width="30%">{{ unit.actual_manday }}</td>
                                </tr>
                                <tr>
                                    <th width="20%">Technical Expert</th>
                                    <td width="30%">{{unit.technical_expert}}</td>
                                    <th width="20%">Translator</th>
                                    <td width="30%">{{unit.translator}}</td>
                                </tr>
                            </table>
                           
                            <table class="table table-bordered col-12" style="font-size:13px;">
                                <thead>
                                <tr>
                                    <th scope="col" class="center" width="10%">S.No</th>
                                    <th scope="col" >Auditor</th>
                                    <th scope="col" >Date(s)</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let auditor of unit?.auditors; index as is;" >
                                        <td scope="row" class="center"   >{{ 1+is}}</td>
                                        <td >{{ auditor.display_name }}</td>
                                        <td>
                                            <span *ngFor="let date of auditor.date; let last=last;" class="txt-bg-3d">{{ date}} </span>
                                            <!-- <ng-container *ngIf="last"> &amp; </ng-container> {{ date}}<span *ngIf="!last">, </span> -->
                                        </td>
                                    </tr> 
                                </tbody>
                            </table>
                           
                           
        
                        </div>
                    </div>
                    
                </div>
        
                <div style="float:left;width:100%;"  *ngIf="history?.inspectionplan">
                    <mat-accordion>
                        <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    Audit Plan
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <div class="card-box enq-view" >
                            
                                <h3>Audit Plan Details</h3>
                                
                                <table class="table table-bordered col-12" style="font-size:13px;">
                                    <thead>
										<tr>
											<th scope="col" class="center" width="5%">S.No</th>
											<th scope="col" width="15%">Location</th>
											<th scope="col" width="15%">Activity</th>
											<th scope="col" width="15%">Inspector</th>
											<th scope="col" width="12%" class="center">Date</th>
											<th scope="col" width="9%" class="center">Start Time</th>
											<th scope="col" width="9%" class="center">End Time</th>
											<th scope="col" width="20%">Persons need to be present</th>
										</tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let plans of history?.inspectionplan; index as is">
                                            <td scope="row" class="center">{{ 1+is}}</td>
											<td>{{ plans.application_unit_name }}</td>
                                            <td>{{ plans.activity }}</td>
                                            <td>{{ plans.inspector }}</td>
                                            <td class="center">{{ plans.date }}</td>
                                            <td class="center">{{ plans.start_time }}</td>
                                            <td class="center">{{ plans.end_time }}</td>
                                            <td>{{ plans.person_need_to_be_present }}</td>
                                        </tr> 
                                    </tbody>
                                </table>
								
								
                                
                            </div>
							<button type="button"  *ngIf="(userType==2 && auditPlanData.status >= auditPlanData.arrEnumStatus['awaiting_for_customer_approval']  ) || (userdetails.resource_access==1  && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process'])|| (userType==1 && auditPlanData.status >= auditPlanData.arrEnumStatus['inspection_plan_in_process']  && userdetails.uid==auditPlanData.application_lead_auditor)"  style="width:240px;" (click)="downloadInspection(this.id);openmodal(downloading)" [disabled]="loading" class="btn but-cust green m-b-5 ml-2 m-r-5"  >
								<span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
								Download Audit Plan as PDF</button>
                        </mat-expansion-panel>                
                    </mat-accordion>
                </div>
        
               <!-- <div class="un-lst" *ngIf="auditPlanData?.auditreviews" ><h3>Review Details</h3></div> -->
               <div style="float:left;width:100%;">
                    <mat-accordion *ngFor="let auditreview of history.auditreviews; index as i">
                        <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    Risk Assesment Details
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <div class="card-box enq-view">
                            
                                <h3>Reviewer Details</h3>
                                <table class="table-secondary m-b-15">
                                    <tr>
                                        <th width="20%">Reviewer</th>
                                        <td width="30%">{{ auditreview.reviewer }}</td>
                                        <th width="20%">Answer</th>
                                        <td width="30%">{{ auditreview.answer_name }}</td>
                                    </tr>
                                    <tr>
                                        <th width="20%">Status</th>
                                        <td width="30%">{{ auditreview.status_name }}</td>
                                        <th width="20%">Created Date &amp; Time</th>
                                        <td width="30%">{{ auditreview.created_at }}</td>
                                    </tr>
                                    <tr>
                                        <th width="20%">Review Result</th>
                                        <td colspan="3">{{ auditreview.review_result_name }}</td>
                                    </tr>
                                    <tr>
                                        <th width="20%">Comments</th>
                                        <td colspan="3">{{ auditreview.status_comments }}</td>
                                    </tr>
                                </table>
                                
                                
        
                                <div   >
                                    <h3 *ngIf="auditreview?.reviewcomments.length>0">Reviewer Comments</h3>
                                    
                                    <div class="page-title-box">
                                        <div *ngFor="let reviewcomment of auditreview.reviewcomments; index as i">	
                                            <div class="qustion">
                                            <h5>{{ 1+i }}. {{ reviewcomment.question }}</h5>
                                            {{ reviewcomment.answer }}
                                            <p [innerHTML]="reviewcomment.comment"></p>
                                            </div>
                                        </div>  
                                    </div>
        
                                    <h3 *ngIf="auditreview?.unitreviewcomments.length>0">Facility Review Comments</h3>
                                    
                                    <div class="page-title-box" *ngFor="let unitreviewcomment of auditreview.unitreviewcomments; index as i" >
        
                                        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" [expanded]="true">
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>
                                                    Unit: {{ unitreviewcomment.unit_name }}
                                                </mat-panel-title>
                                            </mat-expansion-panel-header>
                                            <div *ngFor="let unitreviewcomment of unitreviewcomment.reviews; index as j">	
                                                <div class="qustion">
                                                    <h5>{{ 1+j }}. {{ unitreviewcomment.question }}</h5>
                                                    {{ unitreviewcomment.answer }}
                                                    <p [innerHTML]="unitreviewcomment.comment"></p>
                                                </div>
                                            </div>  
                                        </mat-expansion-panel>
        
                                    </div>
                                </div>
                                
                                
                                
                                
                                
                            </div>
                        </mat-expansion-panel>                
                    </mat-accordion>
                </div>

               
        
        
            </div>
            </mat-expansion-panel>                
        </mat-accordion>
        </div>

        <div class="un-lst" *ngIf="auditPlanData?.reviews"><h3>Certification Review Log</h3></div>
        <div style="float:left;width:100%;">
            <mat-accordion *ngFor="let reviewdata of auditPlanData.reviews; index as i">
                <mat-expansion-panel (opened)="panelOpenState = false" (closed)="panelOpenState = true">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Review {{ i+1 }}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="card-box enq-view">
                    
                        <h3>Reviewer Details</h3>
                        <table class="table-secondary m-b-15">
                            <tr>
                                <th width="20%">Reviewer</th>
                                <td width="30%">{{ reviewdata.user_id_label }}</td>
                                <th width="20%">Created Date</th>
                                <td width="30%">{{ reviewdata.created_at }}</td>
                            </tr>
                            <tr>
                                <th width="20%">Comments</th>
                                <td colspan="3">{{ reviewdata.comment }}</td>
                            </tr>
                            <tr *ngIf="reviewdata.extension_date">
                                <th width="20%">Extension Date</th>
                                <td colspan="3">{{ reviewdata.extension_date }}</td>
                            </tr>
                        </table>
                    </div>
                </mat-expansion-panel>                
            </mat-accordion>
        </div>
		
        <!-- <div class="card-box enq-view m-t-15">
            <div  *ngIf="error" class="alert alert-danger mt-3 mb-2">{{error}}</div>
            <div  *ngIf="success" class="alert alert-success mt-3 mb-2" >{{success}}</div>
        </div> -->
        
        

		
		<!--
        <ng-container *ngIf="auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['certificate_generated'] && (userType==2 || userdetails.resource_access==1 ||  (userType==1 && userdetails.uid==auditPlanData.application_lead_auditor && userdetails.rules.includes('audit_execution')) || (userType==1 && userdetails.rules.includes('audit_review') || (userType==1 && userdetails.rules.includes('view_certificate')))) ">
            <div class="text-right">
				<button type="button"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2"  *ngFor="let unitstd of auditPlanData?.units[0].standard; index as i" style="width:auto;" (click)="showCertificatedraft(unitstd.standard_id,'pdf');openmodal(downloading);">
				<span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
				Download Certificate for {{unitstd.standard_name}}</button>
			</div>
        </ng-container>	
		-->
		
		<ng-container *ngIf="(auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['certificate_generated'] || auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['expired'] || auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['extension']) && (userType==3 || userType==2 || userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('certification_review') || (userType==1 && userdetails.rules.includes('view_certificate')))) ">
            <div class="text-right">
				<button type="button"  [disabled]="loading" class="btn but-cust green m-b-5 ml-2" style="width:auto;" (click)="showCertificatedraft(auditPlanData.standard_id,'pdf');openmodal(downloading);">
				<span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
				Download Certificate for {{auditPlanData.standard_name}}</button>
			</div>
        </ng-container>	

        <button type="button" *ngIf="(userdetails.resource_access==1 || (userType==1 && userdetails.rules.includes('certification_review')) ) && (auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['certificate_generated'] || auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['suspension'] || auditPlanData.certificate_status == auditPlanData.arrEnumCertificateStatus['extension'])" [disabled]="loading" class="btn but-cust green m-b-5" (click)="openmodal(reviewCertificate,'')" style="width:188px;">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Review Certificate</button>

        <app-usermessage [success]="success" [error]="error"  ></app-usermessage> 

    </div>

     

</div>
<ng-template #downloading let-modal>
    <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">File Downloading</h4>
    </div>
    <div class="modal-body" style="font-size:16px;">
            Please wait, your file is downloading ...
    </div>
</ng-template>

<ng-template #reviewCertificate let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Review Decision</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
		<span class="c-icon" aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<form  [formGroup]="form">
			<div class="form-group row">
				<div class="col-6">
					<label>Status <span class="text-danger">*</span></label> <i class="fa fa-info-circle text-info ml-1 info-icon-size" matTooltip="Status" matTooltipClass="tooltip-text-size" aria-tooltip="Status" matTooltipPosition="right"></i>
					<select formControlName="status" [class.is-invalid]="f.status.invalid && f.status.touched" class="form-control select2">
						<option value="">-- Status --</option>
						<!--<option *ngFor="let app of appdata" value = {{app.id}}>{{app.company_name}}</option>-->
						<option *ngFor="let status of certificatestatus | keyvalue" value= {{status.key}}>{{ status.value }}</option>
					</select>					
					<div *ngIf="f.status.errors" class="invalid-feedback">
						<div *ngIf="f.status.errors.required">Status is required</div>
					</div>	
				</div>
			</div>	
			
			<div class="clearfix"></div>
			
			<div class="form-group row" *ngIf="f.status.value==3">
				<div class="col-6">
					<label>Extension Date <span class="text-danger">*</span></label> <i class="fa fa-info-circle text-info ml-1 info-icon-size" matTooltip="Extension Date" matTooltipClass="tooltip-text-size" aria-tooltip="Extension Date" matTooltipPosition="left"></i>						
					<input style="width: 70%; display: inline;float:left;" type="text" [min]="minDate" formControlName="extension_date" class="form-control" placeholder="Extension Date" [class.is-invalid]="f.extension_date.invalid && f.extension_date.touched" matInput [matDatepicker]="extension_date" (click)="extension_date.open()">
					<mat-datepicker-toggle matSuffix  [for]="extension_date" style="float:left;"></mat-datepicker-toggle>
					<mat-datepicker #extension_date></mat-datepicker>						
					<div *ngIf="f.extension_date.errors" class="invalid-feedback">
						<div *ngIf="f.extension_date.errors.required" >Extension Date is required</div>														
					</div>
				</div>
			</div>
			
			<div class="clearfix"></div>
			
			<!--
			<div class="form-group row m-t-15">
				<div class="col-12">
					<label>Status <span class="text-danger">*</span></label> <i class="fa fa-info-circle text-info ml-1 info-icon-size" matTooltip="Status" matTooltipClass="tooltip-text-size" aria-tooltip="Status" matTooltipPosition="right"></i>
					<select formControlName="status" [class.is-invalid]="f.status.invalid && f.status.touched" class="form-control select2" (change)='oncompanychange($event.target.value)'>
						<option value="">-- Status --</option>
						<option *ngFor="let app of appdata" value = {{app.id}}>{{app.company_name}}</option>
						<option *ngFor="let status of certificatestatus | keyvalue" value= {{status.key}}>{{ status.value }}</option>
					</select>					
					<div *ngIf="f.status.errors" class="invalid-feedback">
						<div *ngIf="f.status.errors.required" >Status is required</div>
					</div>	
				</div>
			</div>	
			-->
			
			<div class="form-group row">
				<div class="col-12">
					<label>Comment <span class="text-danger">*</span></label> <i class="fa fa-info-circle text-info ml-1 info-icon-size" matTooltip="Comment" matTooltipClass="tooltip-text-size" aria-tooltip="Comment" matTooltipPosition="right"></i>
					<textarea formControlName="comment" placeholder="Comment"  [class.is-invalid]="f.comment.invalid && f.comment.touched" rows="5" class="form-control"></textarea>
					<div *ngIf="f.comment.errors" class="invalid-feedback">
						<div *ngIf="f.comment.errors.required">Comment is required</div>
						<div *ngIf="f.comment.errors.pattern || f.comment.hasError('whitespace')">Invalid Comment</div>
					</div>
				</div>
			</div>	
					
		</form>
		
		<!--
		<form>
            <div class="form-group">
                <label for="status">Status <span class="text-danger">*</span></label>
                <div class="input-group">
                    <select name="status" #reviewStatus="ngModel" [(ngModel)]="model.status"  class="form-control select2" style="width:120px; display:inline;" >
                        <option value="">-- Status --</option>
                        <option *ngFor="let status of certificatestatus | keyvalue" value= {{status.key}}>{{ status.value }}</option>
                    </select>     
                </div>
                <div class="validationerror" *ngIf="status_error"  >Please select the status</div>
            </div>
            
            <div class="form-group" *ngIf="(reviewStatus.value !== undefined && reviewStatus.value!='' && (reviewStatus.value==3 ))?true:false">
                <label for="status">Extension Date <span class="text-danger">*</span></label>
                <div class="input-group" style="width: 76%;">
                    <input [required]="(reviewStatus.value !== undefined && reviewStatus.value!='' && reviewStatus.value==3 )?true:false" style="width: 120px; display: inline;" type="text" [(ngModel)]="model.extension_date" name="extension_date" class="form-control" placeholder="Date" matInput [matDatepicker]="extension_date" (click)="extension_date.open()">
                    <mat-datepicker-toggle matSuffix  [for]="extension_date"></mat-datepicker-toggle>
                    <mat-datepicker #extension_date></mat-datepicker>
                </div>
                <div class="validationerror" *ngIf="date_error"  >Please Select the Extension Date</div>
            </div>
            
            <div class="form-group">
                <label for="status">Comment(s) <span class="text-danger">*</span></label>
                <div class="input-group">                            
                    <textarea name="comment" [(ngModel)]="model.comment" rows="4" style="width:100%; display:inline;" ></textarea>                    
                    <div class="validationerror" *ngIf="comment_error"  >Please enter the Comment</div>
                </div>
            </div>
		</form>
		-->
		
	</div>
	<div class="modal-footer">
        <button type="button" [disabled]="loading" class="btn btn-success " (click)="checkUserSel()">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>Save</button>
            
		<button type="button" [disabled]="loading" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">
		<span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>Cancel</button>
	</div>
</ng-template>
